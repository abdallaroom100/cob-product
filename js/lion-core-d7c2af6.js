"use strict";(self.webpackChunk_loyaltylion_tonks=self.webpackChunk_loyaltylion_tonks||[]).push([[443],{4142:(e,t,r)=>{var i=r(4358).compose;t.tY=function(){if(0!==arguments.length)return"object"==typeof arguments[0]?i:i.apply(null,arguments)}},7509:(e,t,r)=>{t.I7=void 0;var i=r(4358),n=function(){var e=[],t=[],r=void 0;return{enhancer:function(e){return r=e,function(e){return function(r){return i.compose.apply(void 0,t)(e)(r)}}},addMiddleware:function(){for(var i,n,o=arguments.length,s=Array(o),a=0;a<o;a++)s[a]=arguments[a];(i=t).push.apply(i,s.map((function(e){return e(r)}))),(n=e).push.apply(n,s)},removeMiddleware:function(r){var i=e.findIndex((function(e){return e===r}));-1!==i?(e=e.filter((function(e,t){return t!==i})),t=t.filter((function(e,t){return t!==i}))):console.error("Middleware does not exist!",r)},resetMiddlewares:function(){t=[],e=[]}}},o=n();t.Ay=o.enhancer;var s=o.addMiddleware,a=o.removeMiddleware,c=o.resetMiddlewares;t.I7=s},5317:(e,t,r)=>{r.d(t,{U:()=>n});var i=r(7775);const n=()=>(0,i.VP)("[modals] clear")},1885:(e,t,r)=>{r.d(t,{DL:()=>l,Ui:()=>a,eN:()=>u,nu:()=>c,qZ:()=>d});var i=r(7775),n=r(7990),o=r(4125),s=r(4803);const a=e=>(0,i.VP)("[referral widget] set email form values",{values:e}),c=()=>(0,i.VP)("[referral widget] submit email form request"),l=()=>(0,i.VP)("[referral widget] submit email form request ok"),d=()=>(0,i.VP)("[referral widget] submit email form request reset"),u=e=>async(t,r)=>{t(c()),(0,o.qO)({location:"email"});const i=n.H.buildFromState(r(),t),a=await i.referrals.sendEmail(e);if("error"in a)return alert(409===a.error.status?(0,s.t)("ui.referral_popup.duplicate_email"):a.error.message??"Sorry, something went wrong. Please try again in a moment"),void t(d());t(l())}},9645:(e,t,r)=>{r.d(t,{$h:()=>d,EX:()=>u,Rd:()=>c,mq:()=>p});var i=r(7775),n=r(7990),o=r(8551),s=r(9331),a=r(7881);const c={setReady:()=>(o.v.debug("[checkoutRedemptionActions] setReady"),(0,i.VP)("[checkout redemption] ready")),setInputMode:e=>(0,i.VP)("[checkout redemption] set input mode",{mode:e}),setEligibleTotalForDiscount:e=>(0,i.VP)("[checkout redemption] set eligible total for discount",{price:e}),setRedemptionClaiming:()=>(0,i.VP)("[checkout redemption] redemption applying"),setRedemptionApplying:e=>(0,i.VP)("[checkout redemption] redemption submitted",{voucher:e}),setRedemptionRemoving:()=>(0,i.VP)("[checkout redemption] redemption removing"),setRedemptionRemoved:()=>(0,i.VP)("[checkout redemption] redemption removed"),setError:e=>(0,i.VP)("[checkout redemption] set error",{error:e}),setRedemptionValue:e=>(0,i.VP)("[checkout redemption] set redemption value",{amount:e}),setShopifyCheckoutToken:e=>(0,i.VP)("[checkout redemption] set shopify checkout token",{token:e}),setRedemptionApplied:e=>(0,i.VP)("[checkout redemption] redemption applied",{voucher:e}),setHasSubscriptionAppInstalled:()=>(0,i.VP)("[checkout redemption] set has subscription app installed")},l=c,d=(e,t)=>async(r,i)=>{const o=n.H.buildFromState(i(),r),s=await o.customers.cancelCheckoutDiscount(e,t);return!("error"in s)||(r(l.setError(s.error)),!1)},u=()=>(e,t)=>{const{id:r}=(0,a.PM)(t());r&&(e(l.setRedemptionRemoving()),(0,s.MO)())},p=()=>async(e,t)=>{e(l.setRedemptionClaiming());const r=n.H.buildFromState(t(),e),i=(0,a.vv)(t()),o=(0,a.Lg)(t()),u=(0,a.Dj)(t());if(!o)return;e(c.setRedemptionValue(o));const p=await r.customers.redeemCheckoutDiscount(o,i.shopifyCheckoutToken,u);if("error"in p)e(l.setError(p.error));else try{e(l.setRedemptionApplying({id:p.claimedReward.id,code:p.claimedReward.code})),(0,s.b5)(p.claimedReward.code),setTimeout((()=>{const{voucher:{isApplying:r}}=(0,a.vv)(t());r&&e(d(p.claimedReward.id,(0,s.Q9)()?"slider_conflict":"slider_timeout")).then((()=>e(l.setRedemptionRemoved()))).catch((()=>{}))}),5e3)}catch(t){e(l.setError({message:`Failed to apply discount to the cart: ${t.message}`,type:"client_error"}))}}},7366:(e,t,r)=>{r.d(t,{Ey:()=>s,lL:()=>n,rW:()=>o,vq:()=>i});const i={section:"order-summary__section"},n={orderSubtotal:"data-checkout-subtotal-price-target",giftCardAmount:"data-checkout-applied-gift-card-amount-target"},o={section:`.${i.section}`,orderSummary:".order-summary__sections",orderSummaryErrors:".order-summary__section--discount .field--error, .order-summary__section--discount .notice--warning",orderSummaryNotices:".order-summary__section--discount .notice--info",orderSubtotal:`*[${n.orderSubtotal}]`,giftCardAmount:`*[${n.giftCardAmount}]`,discountSection:".order-summary__section--discount",appliedReductionCodes:".reduction-code .reduction-code__text",appliedReductionTag:".order-summary__section--total-lines button, .order-summary__section--discount .tag__wrapper",appliedReductionTags:{removeButton:".tag__button"},button:{content:".btn__content",iconForMobile:".btn__icon.shown-on-mobile",spinner:".btn__spinner"},discountForm:{codeInput:"input[data-discount-field]",submitButton:".order-summary__section--discount button"}},s=1e3},9331:(e,t,r)=>{r.d(t,{MO:()=>a,Q9:()=>u,b5:()=>s,n5:()=>d});var i=r(6083),n=r(2668),o=r(7366);function s(e){const t=document.querySelector(o.rW.discountForm.codeInput),r=document.querySelector(o.rW.discountForm.submitButton);if(!t?.form||!r)throw new n.I("Discount input or submit button not found");t.setAttribute("value",e),t.form.dispatchEvent(l()),t.setAttribute("value",""),c(r)}function a(){const e=(0,i.A6)(document.querySelectorAll(o.rW.appliedReductionTag)).filter((e=>Boolean(e.querySelector('input[name="checkout[clear_discount]"]'))));if(0===e.length)return!1;const t=e[0].querySelector(o.rW.appliedReductionTags.removeButton),r=document.querySelector(o.rW.discountForm.submitButton);return!!t?.form&&(t.form.dispatchEvent(l()),r&&c(r),!0)}function c(e){const t=e.querySelector(o.rW.button.spinner);if(!t)return;const r=e.querySelectorAll([o.rW.button.content,o.rW.button.iconForMobile].join(", "));0!==r.length&&(t.style.display="none",r.forEach((e=>e.style.opacity="1")))}function l(){const e=document.createEvent("Event");return e.initEvent("submit",!0,!0),e}function d(){return(0,i.A6)(document.querySelectorAll(o.rW.orderSummaryErrors)).length>0}function u(){return(0,i.A6)(document.querySelectorAll(o.rW.orderSummaryNotices)).length>0}},1650:(e,t,r)=>{r.d(t,{Q4:()=>a,YZ:()=>d,gW:()=>s,mE:()=>l,rY:()=>c,wB:()=>o});var i=r(4803),n=r(8551);function o(e,t){const r=("points"===t?e.loyaltyTierEligiblePoints:e.loyaltyTierEligibleSpend)??0;return"points"===t?r:r/100}function s(e,t){return"points"===t?e.bounds:{lower:e.bounds.lower/100,upper:e.bounds.upper?e.bounds.upper/100:null}}function a(e,t,r){const i=("points"===r?t.loyaltyTierEligiblePointsAtMembershipExpiration:t.loyaltyTierEligibleSpendAtMembershipExpiration)??0,n=Math.max(0,e.bounds.lower-i);return"points"===r?n:n/100}function c(e,t,r){if(e.bounds.upper){const i=("points"===r?t.loyaltyTierEligiblePoints:t.loyaltyTierEligibleSpend)??0,n=e.bounds.upper>=i?e.bounds.upper+1-i:0;return"points"===r?n:n/100}return null}function l(e,t,r,i){if(!e.bounds.upper||!i)return null;const o=(()=>{switch(r){case"points":return null===t.loyaltyTierEligiblePoints?null:Math.max((t.loyaltyTierEligiblePoints-e.bounds.lower)/(e.bounds.upper-e.bounds.lower),0);case"spend":return null===t.loyaltyTierEligibleSpend?null:Math.max((t.loyaltyTierEligibleSpend-e.bounds.lower)/(e.bounds.upper-e.bounds.lower),0)}})();return"number"==typeof o&&o>1?(n.v.error("Invalid tiers progress calculation: should be in next tier",{tier:e,customer:t,tiersMode:r,isCurrent:i,progress:o}),null):o}function d(e,t){return e?.loyaltyTierMembership?.expiresAt?(0,i.Yq)(new Date(e.loyaltyTierMembership.expiresAt),t):null}},7881:(e,t,r)=>{r.d(t,{Lg:()=>f,Jd:()=>u,VE:()=>g,Vh:()=>d,bL:()=>v,N9:()=>w,Nh:()=>c,vv:()=>a,PM:()=>b,Dj:()=>y,Py:()=>p,yz:()=>m});var i=r(4477);r(4485);class n extends Error{constructor(...e){super(...e),this.name="NoCheckoutRedemptionRewardError"}}var o=r(392),s=r(8172);const a=e=>e.checkoutRedemption,c=(0,i.Mz)(a,(e=>{let{ready:t}=e;return t})),l=(0,i.Mz)(s.VI,(e=>{if(!e)throw new n("Checkout redemption reward required for this feature");return e})),d=(0,i.Mz)(a,(e=>e.inputMode)),u=e=>e.checkoutRedemption.eligibleTotalForDiscount,p=(0,i.Mz)(u,(e=>e>0)),h=(0,i.Mz)(a,s.VI,o.hQ,((e,t,r)=>{if(!t)throw new n("Checkout redemption reward required for this feature");const{eligibleTotalForDiscount:i,redeemDiscountValue:o,voucher:{code:s}}=e,a=s&&o?o:0,c=Math.floor(r.pointsRedeemable/t.point_cost),l=Math.min(t.max_redemption_amount,Math.ceil(i/100),c+a),d=t.redemption_amount_step;return Math.floor(l/d)*d})),m=(0,i.Mz)(l,h,((e,t)=>t>=e.min_redemption_amount)),g=(0,i.Mz)(a,(e=>{let{voucher:{code:t,isApplying:r}}=e;return null!==t&&!r})),f=(0,i.Mz)(a,l,h,((e,t,r)=>{const{redeemDiscountValue:i,inputMode:n}=e;if(null!==i)return i;switch(n){case"select":return r;case"slider":return t.min_redemption_amount}})),y=(0,i.Mz)(a,(e=>{let{hasSubscriptionAppInstalled:t}=e;return t})),v=(0,i.Mz)(a,l,h,m,f,p,((e,t,r,i,n,o)=>{const{redemption_amount_step:s,min_redemption_amount:a,point_cost:c}=t,{voucher:l}=e;return{disabled:null!==l.code||!i||!o,min:a,max:r,step:s,pointsPerUnit:c,value:n}})),w=(0,i.Mz)(l,(e=>e.point_cost*e.min_redemption_amount)),b=e=>e.checkoutRedemption.voucher;(0,i.Mz)(a,(e=>e.voucher.code))},4802:(e,t,r)=>{r.d(t,{I:()=>a});var i=r(4477),n=r(392),o=r(1410),s=r(961);const a=(0,i.Mz)(o.SP,n.hQ,s.oB,s.Yv,((e,t,r,i)=>e?t.pointsRedeemable+r-i:t.pointsRedeemable))},8895:(e,t,r)=>{r.d(t,{Ez:()=>c,Kx:()=>l,wt:()=>d});var i=r(4477),n=r(9357),o=r(6048),s=r(2186),a=r(2691);const c=(0,i.Mz)(s.NB,(e=>e.loyaltyWidget)),l=(0,i.Mz)(c,(e=>e.enabled)),d=(0,i.Mz)(c,n.G,o.ZC,a.vy,((e,t,r,i)=>(e.enabled||i)&&(!t.checkout||r.onThankYou)))},2877:(e,t,r)=>{r.d(t,{M:()=>s,R:()=>a});var i=r(7775),n=r(6655),o=r(1476);const s=e=>(0,i.VP)("[beacon] set content width",{width:e}),a=()=>async(e,t)=>{(0,n.KW)(t())?e((0,o.WT)()):e((0,o.Q9)())}},7391:(e,t,r)=>{r.d(t,{Hf:()=>f,Oo:()=>p,R0:()=>l,c3:()=>a,cQ:()=>c,eN:()=>y,iE:()=>d,jv:()=>g,qf:()=>u,uW:()=>m,yj:()=>h});var i=r(7775),n=r(7990),o=r(4125),s=r(4803);const a=()=>(0,i.VP)("[refer-email] open toast"),c=()=>(0,i.VP)("[refer-email] close toast"),l=e=>(0,i.VP)("[refer-email] set toast message",{message:e}),d=e=>(0,i.VP)("[refer-email] set toast status",{status:e}),u=()=>(0,i.VP)("[refer-email] modal open"),p=()=>(0,i.VP)("[refer-email] modal close"),h=()=>(0,i.VP)("[refer-email] set form request"),m=()=>(0,i.VP)("[refer-email] set form request ok"),g=()=>(0,i.VP)("[refer-email] set form request reset"),f=(e,t)=>r=>{r(l(e)),r(d(t)),r(a()),setTimeout((()=>{r(c())}),2500),"success"===t&&(r(g()),r(p()))},y=e=>async(t,r)=>{t(h()),(0,o.qO)({location:"email"});const i=n.H.buildFromState(r(),t),u=await i.referrals.sendEmail(e);if("error"in u)return t(l(409===u.error.status?(0,s.t)("app_turnkey.refer.duplicate_email"):u.error.message??(0,s.t)("app_turnkey.general.something_went_wrong"))),t(d("error")),t(a()),setTimeout((()=>{t(c())}),2500),void t(g());t(m()),t(f("Email sent!","success"))}},3723:(e,t,r)=>{r.d(t,{CU:()=>u,HN:()=>l,I:()=>g,Iu:()=>d,M2:()=>m,P1:()=>f,QO:()=>c,UB:()=>a,eP:()=>h,un:()=>p});var i=r(7990),n=r(5868),o=r(770),s=r(7775);const a=(e,t)=>(0,s.VP)("[ruleAction] set toast status",{id:e,status:t}),c=e=>(0,s.VP)("[ruleAction] close toast",{id:e}),l=e=>(0,s.VP)("[ruleAction] reset ruleAction state",{id:e}),d=e=>(0,s.VP)("[ruleAction] open modal",{id:e}),u=e=>(0,s.VP)("[ruleAction] close modal",{id:e}),p=e=>(0,s.VP)("[ruleAction] submit request",{id:e}),h=(e,t)=>(0,s.VP)("[ruleAction] set result",{id:e,result:t}),m=(e,t)=>async(r,n)=>{if(t.isEarning)return;r(p(e));const o=i.H.buildFromState(n(),r),s=await o.customers.signupToNewsletter();if("error"in s){const t=s.error.message??s.error.type;return r(h(e,{status:"error",err:{message:t}})),y(r,e),r(a(e,"error")),void v(r,e)}return r(h(e,{status:"success"})),y(r,e),r(a(e,"success")),v(r,e),s},g=(e,t,r)=>async(n,o)=>{if(r.isEarning)return;n(p(t));const s=i.H.buildFromState(o(),n),c=await s.customers.setBirthday({birthday:e});if("error"in c){const e=c.error.message||c.error.type;return n(h(t,{status:"error",err:{message:e}})),y(n,t),n(a(t,"error")),void v(n,t)}n(h(t,{status:"success"})),y(n,t),n(a(t,"success")),v(n,t)},f=e=>{let{ruleId:t,ruleAction:r,properties:s}=e;return async(e,c)=>{if(r?.isEarning)return;const l=(0,o.lb)(c(),t);if(!l)return;e(p(t));const d=i.H.buildFromState(c(),e),u=await d.customers.trackEvent({name:l.name,properties:s});if("error"in u){const r=u.error.message||u.error.type;return e(h(t,{status:"error",err:{message:r}})),y(e,t),e(a(t,"error")),void v(e,t)}l.oneTime&&e((0,n.Gk)({ruleContext:[{id:t,limitReached:!0}]})),e(h(t,{status:"success"})),y(e,t),e(a(t,"success")),v(e,t)}},y=(e,t)=>{setTimeout((()=>{e(u(t))}),200)},v=(e,t)=>{setTimeout((()=>{e(c(t))}),3e3)}},6591:(e,t,r)=>{r.d(t,{X:()=>o,o:()=>n});var i=r(7775);const n=e=>(0,i.VP)("[turnkey client config] set config",{config:e}),o=(0,i.vy)({forceMode:null},(e=>[e(n,((e,t)=>{let{config:r}=t;return r}))]))},898:(e,t,r)=>{r.d(t,{q:()=>o,Y:()=>n});var i=r(7775);const n=e=>(0,i.VP)("[turnkey] set customisations",{customisations:e}),o=(0,i.vy)({keyColors:{primary:"#5f50d4",secondary:"#42d4b2"},interfaceColors:{buttons:"primary",icons:"secondary",links:"secondary"},header:{backgroundColor:"secondary",backgroundImage:""},homeActionTiles:{backgroundColor:"primary",textColor:"white"},widget:{backgroundColor:"primary",textColor:"white",position:"right",visible:"true"},dashboard:{textHelp:""}},(e=>[e(n,((e,t)=>{let{customisations:r}=t;return r}))]))},3782:(e,t,r)=>{r.d(t,{HK:()=>p,Nn:()=>s,V2:()=>o});var i=r(7775),n=r(3723);function o(e){return"success"===e}const s={modalOpen:!1,isEarning:!1,result:null,toast:{status:null}},a=e=>({...e,modalOpen:!0}),c=e=>({...e,modalOpen:!1}),l=e=>({...e,toast:{status:null}}),d=e=>({...e,isEarning:!0}),u=e=>s,p=(0,i.vy)({},(e=>[e(n.Iu,((e,t)=>{let{id:r}=t;return(0,i.rg)(e,r,a,s,{applyToOthers:[c]})})),e(n.CU,((e,t)=>{let{id:r}=t;return(0,i.rg)(e,r,c,s,{applyToOthers:[c]})})),e(n.un,((e,t)=>{let{id:r}=t;return(0,i.rg)(e,r,d,s)})),e(n.eP,((e,t)=>(0,i.rg)(e,t.id,(e=>{let{result:t}=e;return e=>({...e,isEarning:!1,result:t})})(t),s))),e(n.QO,((e,t)=>{let{id:r}=t;return(0,i.rg)(e,r,l,s,{applyToOthers:[l]})})),e(n.UB,((e,t)=>(0,i.rg)(e,t.id,(e=>{let{status:t}=e;return e=>({...e,toast:{status:t}})})(t),s))),e(n.HN,((e,t)=>{let{id:r}=t;return(0,i.rg)(e,r,u,s)}))]))},3468:(e,t,r)=>{r.d(t,{D:()=>a,L:()=>s});var i=r(7775),n=r(96),o=r(959);const s=e=>(0,i.VP)("[translations] set",{translations:e}),a=e=>(t,r)=>{const i=(0,o.w)(r()),a=(0,n.l)(r());a&&t(s({...a,[i]:{...a[i],...e}}))}},6772:(e,t,r)=>{r.d(t,{E:()=>o,i:()=>n});var i=r(7775);const n={update:e=>(0,i.VP)("[program] update",{program:e}),addRule:e=>(0,i.VP)("[program] add rule",{rule:e})},o=n.update},7655:(e,t,r)=>{r.d(t,{N9:()=>l,R5:()=>c,VP:()=>a,hv:()=>d});var i=r(7775),n=r(7990),o=r(959),s=r(6942);const a=e=>(0,i.VP)("[referee incentive] set code",{code:e}),c=()=>(0,i.VP)("[referee incentive] set code fetching"),l=e=>(0,i.VP)("[referee incentive] set code fetching error",{error:e}),d=e=>async(t,r)=>{t(c());const i=n.H.buildFromState(r(),t),d=await i.referrals.refereeIncentiveCode({siteToken:(0,o.Jr)(r()),referralId:e});"error"in d?t(l(d.error)):(t(a(d.code)),t((0,s.K7)(d.referralBlocked)))}},6942:(e,t,r)=>{r.d(t,{Ih:()=>a,K7:()=>d,Rb:()=>l,de:()=>c,gd:()=>u,pA:()=>p});var i=r(7775),n=r(392),o=r(1410),s=r(7655);const a=e=>(0,i.VP)("[referral welcome modal] set open",{open:e}),c=e=>(t,r)=>{const i=r(),c=(0,n.L4)(i);if(!(0,o.e6)(i))return;const l=!c;t(a(l)),l&&t((0,s.hv)(e))},l=()=>(0,i.VP)("[referral welcome modal] close"),d=e=>(0,i.VP)("[referred] set referral blocked",{referralBlocked:e}),u=e=>(0,i.VP)("[referral welcome modal] set discount applied modal open",{open:e}),p=()=>e=>{e(u(!0))}},32:(e,t,r)=>{r.d(t,{a:()=>o,c:()=>i});var i,n=r(7775);!function(e){e.ChangeState="[root] change state",e.RemoveCustomer="[root] remove customer"}(i||(i={}));const o={removeCustomer:()=>(0,n.VP)(i.RemoveCustomer),changeState:e=>(0,n.VP)(i.ChangeState,e)}},2869:(e,t,r)=>{r.d(t,{J:()=>c,Jv:()=>a,Qn:()=>n,Tp:()=>l,hj:()=>o,pL:()=>s,qf:()=>d});var i=r(7775);const n=e=>(0,i.VP)("[site] set",{site:e}),o=e=>(0,i.VP)("[site] update",{site:e}),s=e=>(0,i.VP)("[site] change locale",{locale:e}),a=e=>(0,i.VP)("[site] update integrated loyalty page sections",{sections:e}),c=e=>(0,i.VP)("[site] set theme configuration",e),l=e=>(0,i.VP)("[site] update theme configuration",e),d=e=>(0,i.VP)("[site] set site theme content",e)},2668:(e,t,r)=>{r.d(t,{I:()=>i});r(4485);class i extends Error{constructor(...e){super(...e),this.name="ShopifyCheckoutRedemptionError"}}},4001:(e,t,r)=>{r.d(t,{A:()=>o,f:()=>s});var i=r(7775);const n=(0,r(9023).JG)(),o=e=>(0,i.VP)("[browser] set state",{browser:e}),s=(0,i.vy)(n,(e=>[e(o,((e,t)=>{let{browser:r}=t;return{...e,...r}}))]))},667:(e,t,r)=>{r.d(t,{Ad:()=>a,an:()=>o,ko:()=>c,tC:()=>s});r(9332);var i=r(7775),n=r(3424);const o=e=>(0,i.VP)("[page] set init data",{initData:e}),s=e=>(t,r)=>{const i=(0,n.R4)(r()),s=e.customer?.id;if("shogun"!==i||"string"!=typeof s)return t(o(e));t(o({...e,customer:{...e.customer,id:l(s)}}))},a=e=>(0,i.VP)("[page] set integrated page section",{kind:e.kind,section:e}),c=(0,i.vy)({initData:null,integratedPageSections:{}},(e=>[e(o,((e,t)=>{let{initData:r}=t;return{...e,initData:r}})),e(a,((e,t)=>{let{kind:r,section:i}=t;return{...e,integratedPageSections:{...e.integratedPageSections,[r]:i}}}))]));function l(e){return atob(e).replace(/^.+\/Customer\//,"")}},9569:(e,t,r)=>{r.d(t,{E$:()=>c,Nu:()=>l,zN:()=>d});var i=r(4477),n=r(6047),o=r(392),s=r(8172),a=r(6048);function c(e,t){const r=(0,o.L4)(e);if(!r)return!1;const i=(0,s.gY)(e,t);if(!i)return!1;if((0,n.Lu)(i)){const r=(0,a.b5)(e,t);if(1===i.session_options.session_limit&&r)return!1}return!!(r.pointsRedeemable>=i.point_cost)}const l=(0,i.Mz)(s.lf,o.L4,(e=>e),((e,t,r)=>t?e.filter((e=>c(r,e.id))):[])),d=()=>(0,i.Mz)(s.lf,o.L4,((e,t)=>t),(e=>e),((e,t,r,i)=>t?e.filter((e=>function(e,t,r){const i=(0,o.L4)(e);if(!i)return!1;const c=(0,s.gY)(e,t);if(!c)return!1;if((0,n.Lu)(c)){const r=(0,a.b5)(e,t);if(1===c.session_options.session_limit&&r)return!1}return!!(i.pointsApproved>=c.point_cost*((100-r)/100)&&i.pointsApproved<=c.point_cost)}(i,e.id,r))):[]))},961:(e,t,r)=>{r.d(t,{QJ:()=>m,Yv:()=>h,oB:()=>p});var i=r(4477),n=r(8551),o=r(6945),s=r(7024),a=r(8172),c=r(770),l=r(3424),d=r(6048),u=r(959);const p=(0,i.Mz)(d.J1,c.pG,c.gQ,u.yl,l.r,((e,t,r,i,n)=>{if(!e)return 0;if(!t&&0===r.length)return 0;return o.F$.getBasePointsFromCart(e,t,i,n)+o.F$.getBonusPointsFromCart(e,r)})),h=(0,i.Mz)(d.J1,d.aT,d.em,(e=>e),((e,t,r,i)=>{if(!e)return 0;if(0===t.length&&0===r.length)return 0;return t.filter((t=>t.cart_token===e.token)).reduce(((e,t)=>e+t.reward_cost-t.reserved_points),0)+r.map((t=>({cost:m(t,e,i),reservedPoints:t.reservedPoints}))).reduce(((e,t)=>{let{cost:r,reservedPoints:i}=t;return e+r-i}),0)}));function m(e,t,r){const i=e.usages.find((e=>e.cartIdentifier===t.token&&"claimed"===e.status)),o=i&&(0,s.HT)(r,i.claimedRewardId);i&&o||n.v.error("Missing usage or claimedReward for script hash redemption",{redemptionId:e.id,redemptionUsages:e.usages.map((e=>e.id)),usageId:i?.id,claimedRewardId:i?.claimedRewardId});const c=(0,a.gY)(r,e.rewardId);return o?o.point_cost:c?.point_cost??0}},2584:(e,t,r)=>{r.d(t,{D7:()=>y,Dx:()=>d,Nw:()=>g,bd:()=>w,gY:()=>v,v9:()=>f});r(4485);var i=r(4477),n=r(1650),o=r(5052),s=r(392),a=r(1410),c=r(8172),l=r(770);const d=(0,i.Mz)(a.L2,(e=>e.loyaltyTierBenefits));function u(e,t){return t.reduce(((t,r)=>{const i=e.find((e=>e.rewardId===r.id));return i?[...t,{...i,reward:r}]:t}),[])}function p(e,t){return e.reduce(((e,r)=>{const i=t.find((e=>e.id===r.ruleId));return i?[...e,{...r,rule:i}]:e}),[]).sort(((e,t)=>e.rule.sortKey&&t.rule.sortKey?0+e.rule.sortKey-t.rule.sortKey:e.rule.id-t.rule.id))}const h=(0,i.Mz)(c.T7,l.v5,a.a9,s.LH,d,s.L4,a.Kr,((e,t,r,i,o,s,a)=>r.slice().sort(((e,t)=>e.position-t.position)).map((r=>{const c=!!i&&r.id===i.id;return{...r,number:r.position+1,rewardOverrides:u(r.rewardOverrides,e),ruleOverrides:p(r.ruleOverrides,t),benefits:o.filter((e=>e.loyaltyTierIds.includes(r.id))),expiresAt:c?n.YZ(s):null,isConditional:!!r.conditions?.tag,isHidden:r.hidden,isCurrent:c,isNext:!!i&&r.position>i.position,isPrevious:!!i&&r.position<i.position,progressToNextTier:s?n.mE(r,s,a.loyaltyTiersMode,c):null,neededForCurrentTier:s?n.Q4(r,s,a.loyaltyTiersMode):0,toNextTier:s?n.rY(r,s,a.loyaltyTiersMode):null,bounds:n.gW(r,a.loyaltyTiersMode)}})))),m=(0,i.Mz)(a.V4,(e=>!!e&&e.settings.loyaltyTiersEnabled)),g=(0,i.Mz)(m,a.a9,((e,t)=>{const r=t.filter((e=>!e.hidden)).length;if(1===r)throw new Error("There is only one visible tier");return e&&r>0})),f=(0,i.Mz)(a.a9,(e=>e.map((e=>e.id)))),y=(0,i.Mz)(a.a9,s.iI,((e,t)=>e.filter((e=>!e.hidden||e.id===t)).map((e=>e.id)))),v=(0,i.Mz)(y,h,((e,t)=>t.filter((t=>e.includes(t.id))))),w=(0,o._)(((e,t)=>t),h,((e,t)=>t.find((t=>t.id===e))??null))},6098:(e,t,r)=>{r.r(t),r.d(t,{createLion:()=>ln});var i=r(5920),n=r(6436),o=r(8362);function s(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return r}var a=r(4062);function c(e,t){(0,a.A)(e,t),t.add(e)}r(4485);var l=r(8097),d=r(7990),u=r(5317),p=r(1571),h=r(7509),m=r(1410),g=r(959),f=r(2726),y=r(8551),v=r(413),w=r(2691),b=r(4900),A=r(9023);function S(){const e=(0,A.q0)("ll_auth");if(e){const t=function(e){let t;try{t=JSON.parse((0,b.D)(e))}catch{return y.v.warn("Could not parse auth from query",e),null}if(r=t,!("object"==typeof r&&null!==r&&"jwt"in r&&"string"==typeof r.jwt&&"expires_at"in r&&"number"==typeof r.expires_at&&"api_host"in r&&"string"==typeof r.api_host&&"refresh_url"in r&&"string"==typeof r.refresh_url))return y.v.warn("Invalid auth query data",t),null;var r;return{host:t.api_host,jwt:t.jwt,jwtExpiresAt:new Date(1e3*t.expires_at),refreshUrl:t.refresh_url}}(e);if(t)return t}return null}var R=r(258);const k=["shogun","shopify","unknown"];var C=r(6047),P=r(9753),M=r(514);const I=(e,t)=>{let r=null;const i=()=>{const i=e.getState();t(i,r),r=i},n=e.subscribe(i);return i(),n};var _=r(6945),E=r(4737),F=r(8446),T=r(9556),L=r(7775);const q=e=>(0,L.VP)("[api] set revision",{revision:e}),V=e=>(0,L.VP)("[api] set build",{build:e}),W=e=>(0,L.VP)("[auth packet] update",{authPacket:e});var O=r(5868),U=r(3468),D=r(2749),N=r(6772),B=r(32),H=r(7630),x=r(2869),$=r(4206),z=r(7717),j=r(6335),J=r(7415),Q=r(1476),Y=r(9569),K=r(8172),G=r(2186),X=r(4034);function Z(e){const t=e.getState(),r=(0,X.fE)(t),i=(0,G.df)(t);if(r&&(0,K.gY)(t,r)&&(0,Y.E$)(t,r)){if(i)return void function(e,t){setTimeout((()=>{e.dispatch((0,Q.BN)("redeem")),e.dispatch((0,Q.Q9)()),setTimeout((()=>{e.dispatch((0,J.qf)(t))}),$.IP)}),$.Ln)}(e,r);e.dispatch((0,j.hj)(r))}}var ee=r(1850),te=r(392);const re=e=>(0,L.VP)("[email tracking] set",{trackingState:e}),ie=()=>(0,L.VP)("[email tracking] clear action"),ne=()=>(0,L.VP)("[email tracking] clear reward id"),oe=()=>(0,L.VP)("[email tracking] clear email tracking id");function se(e){switch((0,X.Jk)(e.getState())){case"claim_reward":Z(e);break;case"refer":!function(e){const t=e.getState();if((0,G.df)(t)){if(!(0,te.L4)(t))return;setTimeout((()=>{e.dispatch((0,Q.BN)("refer")),e.dispatch((0,Q.Q9)())}),$.Ln)}else e.dispatch((0,ee.N6)())}(e)}e.dispatch(ie()),e.dispatch(ne()),(0,A.Im)("ll_act","ll_rid")}var ae=r(7870),ce=r(770);class le{getBonusPointsForProduct(e){if(!this.enabled)return null;const t=(0,ce.gQ)(this.store.getState()).find((t=>{const{productId:r,productVariantId:i}=t.properties;return!(!i||i!==e.toString())||r===e.toString()}));return t?t.value:null}constructor(e){this.store=e;const t=(0,ae.aQ)(this.store.getState(),"limespot");this.enabled=!!t&&t.enabled}}class de{constructor(e){(0,ae.aQ)(e.getState(),"limespot")&&(this.limespot=new le(e))}}var ue=r(4358),pe=r(2877);const he=(0,L.vy)({contentWidth:0},(e=>[e(pe.M,((e,t)=>{let{width:r}=t;return{...e,contentWidth:r}}))]));var me=r(1076);const ge=e=>({...e,modalOpen:!0}),fe=e=>({...e,modalOpen:!1,isClaiming:!1}),ye=e=>me.j,ve=e=>({...e,isClaiming:!0}),we=e=>({...e,toastOpen:!0}),be=e=>({...e,toastOpen:!1}),Ae=(0,L.vy)({},(e=>[e(J.qf,((e,t)=>{let{id:r}=t;return(0,L.rg)(e,r,ge,me.j,{applyToOthers:[fe,be]})})),e(J.Oo,((e,t)=>{let{id:r}=t;return(0,L.rg)(e,r,fe,me.j)})),e(J.OI,((e,t)=>(0,L.rg)(e,t.id,(e=>{let{result:t}=e;return e=>({...e,result:t})})(t),me.j))),e(J.X7,((e,t)=>{let{id:r}=t;return(0,L.rg)(e,r,ye,me.j)})),e(J.Qb,((e,t)=>{let{id:r}=t;return(0,L.rg)(e,r,ve,me.j)})),e(J.IM,((e,t)=>{let{id:r}=t;return(0,L.rg)(e,r,we,me.j)})),e(J.cQ,((e,t)=>{let{id:r}=t;return(0,L.rg)(e,r,be,me.j)})),e(J.G9,(e=>(0,L.Um)(e,be,me.j)))]));var Se=r(6591),Re=r(898),ke=r(8151);const Ce=(0,L.vy)({contentHeight:0},(e=>[e(ke.j,((e,t)=>{let{height:r}=t;return{...e,contentHeight:r}}))])),Pe=(0,L.vy)({isOpen:!1,page:"dashboard",guestPage:"welcome",headerExpanded:!0,pageOpenFromNotification:null},(e=>[e(Q.y.setPopoutOpen,(e=>({...e,isOpen:!0}))),e(Q.y.setPopoutClosed,(e=>({...e,isOpen:!1}))),e(Q.y.setPopoutPage,((e,t)=>{let{page:r}=t;return{...e,page:r}})),e(Q.bM,((e,t)=>{let{page:r}=t;return{...e,guestPage:r}})),e(Q.Xk,(e=>({...e,headerExpanded:!1}))),e(Q.WY,(e=>({...e,headerExpanded:!0}))),e(Q.jM,((e,t)=>{let{notificationId:r}=t;return{...e,pageOpenFromNotification:r}}))]));var Me=r(7391);const Ie=(0,L.vy)({modalOpen:!1,submitting:!1,submitSuccess:!1,toast:{open:!1,message:"",status:"success"}},(e=>[e(Me.c3,(e=>({...e,toast:{...e.toast,open:!0}}))),e(Me.cQ,(e=>({...e,toast:{...e.toast,open:!1}}))),e(Me.R0,((e,t)=>{let{message:r}=t;return{...e,toast:{...e.toast,message:r}}})),e(Me.iE,((e,t)=>{let{status:r}=t;return{...e,toast:{...e.toast,status:r}}})),e(Me.yj,(e=>({...e,submitting:!0}))),e(Me.uW,(e=>({...e,submitting:!1,submitSuccess:!0}))),e(Me.jv,(e=>({...e,submitting:!1,submitSuccess:!1}))),e(Me.qf,(e=>({...e,modalOpen:!0}))),e(Me.Oo,(e=>({...e,modalOpen:!1})))]));var _e=r(3782);const Ee=(0,ue.combineReducers)({beacon:he,popout:Pe,ruleAction:_e.HK,claim:Ae,referEmail:Ie,notificationsUi:Ce,customisations:Re.q,clientConfig:Se.X}),Fe=Ee(void 0,{type:"@@INIT"}),Te={emailAction:null,emailClaimRewardId:null,emailTrackingId:null},Le=(0,L.vy)(Te,(e=>[e(re,((e,t)=>{let{trackingState:r}=t;return r})),e(ie,(e=>({...e,emailAction:null}))),e(ne,(e=>({...e,emailClaimRewardId:null}))),e(oe,(e=>({...e,emailTrackingId:null})))]));var qe=r(4001);const Ve=e=>(0,L.VP)("[client config] update",{config:e}),We={checkout:!1,disableBundledCSS:!1,disableBundledFonts:!1,useClassIsolator:!1,useThemeOverride:void 0,useUiOverride:void 0,useCamelCaseHooksResources:void 0},Oe=(0,L.vy)(We,(e=>[e(Ve,((e,t)=>{let{config:r}=t;return{...e,...r}}))]));var Ue=r(9629),De=r(667);const Ne={isEmbedded:!1,currentPageId:"rewards",customerBirthdaySubmitError:null,customerNewsletterSignupError:null,customerNewsletterSignupSuccess:null,historyInfoModalOpenFor:null,isCustomerBirthdaySubmitSuccess:!1,isMobileMenuOpen:!1,isCustomerBirthdaySubmitting:!1,isCustomerNewsletterSignupSubmitting:!1,isPendingPointsHelpModalOpen:!1,isReferralWidgetModalOpen:!1,ruleActionModalOpenFor:null,triggeredRuleError:[],triggeredRuleRequesting:[],triggeredRuleSuccess:[]},Be={emailForm:{submitSuccess:!1,submitting:!1,touched:!1,values:{message:"",name:"",recipients:""}}},He={allIds:[],byId:{}},xe={allIds:[],byId:{}},$e={isModalOpen:!1,isDiscountAppliedModalOpen:!1,referralBlocked:null},ze={facebook:{sdkState:"initial"},twitterSdk:"initial",recharge:{}},je={cart:null,cartRewardVariants:[],shopifyScriptRedemptions:[],buyWithPointsStatus:"not_started",freeVariantManagerStatus:"not_started",buyWithPointsManagerStatus:"not_started",localCurrency:null,localCurrencyFailedAttempts:0,onThankYou:!1,frontend:_.EO.getShopifyFrontendFromPage(),shopifyFunctionRedemptions:[]},Je={ready:!1,inputMode:"slider",redeemDiscountValue:null,shopifyCheckoutToken:null,eligibleTotalForDiscount:0,voucher:{code:null,id:null,isRemoving:!1,isApplying:!1},hasSubscriptionAppInstalled:!1},Qe={revision:"",themeManifest:{default:"",modern:""},fontManifest:null},Ye={build:0,revision:""},Ke={value:null,isFetching:!1,error:null},Ge={customRewardDescriptionModalOpenFor:null,isRewardDescriptionModalOpen:!1,redeemRewardErrors:{},redeemRewardModalOpenFor:null,redeemRewardModalClosing:!1,redeemRewardSuccess:null,redeemingRewardFor:null,apply:{}},Xe={translations:null},Ze={app:Qe,api:Ye,authPacket:null,browser:(0,qe.f)(void 0,{type:"@@INIT"}),checkoutRedemption:Je,clientConfiguration:Oe(void 0,{type:"@@INIT"}),customer:null,controlMode:(0,v.Zx)(void 0,{type:"@@INIT"}),emailTracking:Te,hooks:(0,Ue.do)(void 0,{type:"@@INIT"}),integrations:ze,isLoyaltySplashOrPanelModalOpen:false,loyaltyPanel:Ne,notifications:He,page:(0,De.ko)(void 0,{type:"@@INIT"}),productsOnPage:xe,program:null,referralWidget:Be,referred:$e,refereeIncentiveCode:Ke,rewards:Ge,shopify:je,site:null,appTurnkey:Fe,i18n:Xe},et=e=>(0,L.VP)("[app] set revision",{revision:e}),tt=e=>(0,L.VP)("[app] set theme manifest",{themeManifest:e}),rt=e=>(0,L.VP)("[app] set font manifest",{fontManifest:e}),it=e=>(0,L.VP)("[app] set preview mode",{previewMode:e}),nt=et,ot=tt,st=rt,at=(0,L.vy)(Qe,(e=>[e(et,((e,t)=>{let{revision:r}=t;return{...e,revision:r}})),e(tt,((e,t)=>{let{themeManifest:r}=t;return{...e,themeManifest:r}})),e(rt,((e,t)=>{let{fontManifest:r}=t;return{...e,fontManifest:r}})),e(it,((e,t)=>{let{previewMode:r}=t;return{...e,previewMode:r}}))])),ct=e=>e.authPacket;var lt=r(1814),dt=r(4894),ut=r(7228);const pt="UA-116483193-1",{analytics:ht}=(0,A.JG)();function mt(e){return{cid:e.visitorId,v:"1",t:e.type,tid:pt,av:e.appVersion,an:"loyaltylion-sdk",..."eventCategory"in e?{ec:e.eventCategory}:{},..."eventAction"in e?{ea:e.eventAction}:{},dl:e.hostname,ul:ht.userLanguage,sr:ht.screenRes,sd:`${window.screen.pixelDepth}-bit`,vp:ht.viewport,de:ht.characterSet,z:Math.round((new Date).getTime()*Math.random()).toString(),aip:"1"}}function gt(e){ut.L.post("https://www.google-analytics.com/collect",{body:(0,A._b)(mt(e),{skipEmptyValues:!0})}).catch((()=>{}))}class ft{trackPageview(){(0,R.B)()||gt({type:"pageview",visitorId:this.visitorId,hostname:`https://${this.sdkHost}`,appVersion:this.revision})}trackEvent(e,t){(0,R.B)()||gt({type:"event",eventAction:t,eventCategory:e,visitorId:this.visitorId,hostname:`https://${this.sdkHost}`,appVersion:this.revision})}constructor(e,t,r){this.visitorId=e,this.sdkHost=t,this.revision=r}}var yt=r(4803),vt=r(5246),wt=r(2584),bt=r(3207);function At(e,t){switch(t){case"spend":return e.toFixed(2);case"points":return e.toString()}}async function St(e){const t=e.getState(),r=(0,te.L4)(t);if(!r)return null;const i=r.loyaltyTierMembership?(0,wt.bd)(t,r.loyaltyTierMembership.loyaltyTierId):null,n=i?function(e,t,r){return e.loyaltyTierMembership?{expiresAt:e.loyaltyTierMembership.expiresAt,loyaltyTier:{default:t.default,hidden:t.hidden,id:t.id,lowerBound:At(t.bounds.lower,r),upperBound:t.bounds.upper?At(t.bounds.upper,r):null,name:t.name,number:t.number},manual:e.loyaltyTierMembership.manual,startedAt:e.loyaltyTierMembership.startedAt}:null}(r,i,(0,m.L2)(t).settings.loyaltyTiersMode):null;return{birthday:r.birthday,blocked:r.blocked,createdAt:r.createdAt,email:r.email,enrolled:r.enrolled,enrolledAt:r.enrolledAt,guest:r.guest,id:r.id,insightsSegment:r.insightsSegment,merchantId:r.merchantId,metadata:{},pointsApproved:r.pointsRedeemable,pointsPending:r.pointsPending,pointsSpent:r.pointsSpent,properties:r.properties,referralId:r.referralId,referralUrl:r.referralUrls.direct,referredBy:r.referredBy,rewardsClaimed:r.claimedRewards.length,updatedAt:r.updatedAt,loyaltyTierMembership:n,getClaimedRewards:(0,bt.g)(e)}}var Rt=new WeakMap;class kt{async getCustomer(){return St((0,i.A)(this,Rt))}constructor(e){(0,n.A)(this,Rt,{writable:!0,value:void 0}),(0,o.A)(this,Rt,e)}}var Ct=r(9971),Pt=r(4142),Mt=r(9645);const It=(0,L.vy)(Je,(e=>[e(Mt.Rd.setReady,(e=>({...e,ready:!0}))),e(Mt.Rd.setEligibleTotalForDiscount,((e,t)=>{let{price:r}=t;return{...e,eligibleTotalForDiscount:r,redeemDiscountValue:null===e.redeemDiscountValue?null:Math.min(e.redeemDiscountValue,r/100)}})),e(Mt.Rd.setInputMode,((e,t)=>{let{mode:r}=t;return{...e,inputMode:r}})),e(Mt.Rd.setShopifyCheckoutToken,((e,t)=>{let{token:r}=t;return{...e,shopifyCheckoutToken:r}})),e(Mt.Rd.setRedemptionValue,((e,t)=>{let{amount:r}=t;return{...e,redeemDiscountValue:r}})),e(Mt.Rd.setError,(e=>e)),e(Mt.Rd.setRedemptionClaiming,(e=>({...e,voucher:{...e.voucher,isApplying:!0,isRemoving:!1}}))),e(Mt.Rd.setRedemptionApplied,((e,t)=>{let{voucher:r}=t;return{...e,voucher:{...e.voucher,...r,isApplying:!1}}})),e(Mt.Rd.setRedemptionApplying,((e,t)=>{let{voucher:r}=t;return{...e,voucher:{...e.voucher,...r,isRemoving:!1}}})),e(Mt.Rd.setRedemptionRemoving,(e=>({...e,voucher:{...e.voucher,isApplying:!1,isRemoving:!0}}))),e(Mt.Rd.setRedemptionRemoved,(e=>({...e,voucher:{...e.voucher,code:null,id:null,isApplying:!1,isRemoving:!1}}))),e(Mt.Rd.setHasSubscriptionAppInstalled,(e=>({...e,hasSubscriptionAppInstalled:!0})))]));var _t=r(8047);const Et=(0,L.vy)(false,(e=>[e(_t.M,(()=>!0)),e(_t.s,(()=>!1)),e(u.U,(()=>!1))])),Ft=(0,L.vy)(Ne,(e=>[e(ee.Tm,((e,t)=>{let{id:r}=t;return{...e,currentPageId:r}})),e(ee.Jd,((e,t)=>{let{value:r}=t;return{...e,isMobileMenuOpen:r}})),e(ee.Iu,((e,t)=>{let{id:r}=t;return{...e,ruleActionModalOpenFor:r}})),e(ee.Ze,(e=>({...e,ruleActionModalOpenFor:null}))),e(ee.wd,((e,t)=>({...e,historyInfoModalOpenFor:t}))),e(ee.k0,(e=>({...e,historyInfoModalOpenFor:null}))),e(ee.XY,(e=>({...e,isReferralWidgetModalOpen:!0}))),e(ee.XS,(e=>({...e,isReferralWidgetModalOpen:!1}))),e(ee.fR,(e=>({...e,isPendingPointsHelpModalOpen:!0}))),e(ee.tz,(e=>({...e,isPendingPointsHelpModalOpen:!1}))),e(u.U,(e=>({...e,ruleActionModalOpenFor:null,historyInfoModalOpenFor:null,isReferralWidgetModalOpen:!1,isPendingPointsHelpModalOpen:!1}))),e(ee._F,((e,t)=>{let{id:r}=t;return{...e,triggeredRuleRequesting:e.triggeredRuleRequesting.concat(r)}})),e(ee.eO,((e,t)=>{let{id:r}=t;return{...e,triggeredRuleRequesting:e.triggeredRuleRequesting.filter((e=>e!==r))}})),e(ee.K,((e,t)=>({...e,triggeredRuleError:e.triggeredRuleError.concat(t),triggeredRuleRequesting:e.triggeredRuleRequesting.filter((e=>e!==t.id))}))),e(ee.m6,((e,t)=>{let{id:r}=t;return{...e,triggeredRuleError:e.triggeredRuleError.filter((e=>e.id!==r)),triggeredRuleRequesting:e.triggeredRuleRequesting.filter((e=>e!==r)),triggeredRuleSuccess:e.triggeredRuleSuccess.filter((e=>e.id!==r))}})),e(ee.HW,(e=>({...e,isCustomerBirthdaySubmitting:!0}))),e(ee.v3,(e=>({...e,isCustomerBirthdaySubmitSuccess:!0,isCustomerBirthdaySubmitting:!1}))),e(ee.rm,((e,t)=>{let{error:r}=t;return{...e,customerBirthdaySubmitError:r,isCustomerBirthdaySubmitting:!1}})),e(ee.wm,(e=>({...e,customerBirthdaySubmitError:null,isCustomerBirthdaySubmitSuccess:!1,isCustomerBirthdaySubmitting:!1}))),e(ee.D6,(e=>({...e,isCustomerNewsletterSignupSubmitting:!0}))),e(ee.$B,((e,t)=>({...e,customerNewsletterSignupSuccess:t,isCustomerNewsletterSignupSubmitting:!1}))),e(ee.Fl,((e,t)=>{let{error:r}=t;return{...e,customerNewsletterSignupError:r,isCustomerNewsletterSignupSubmitting:!1}})),e(ee.WH,(e=>({...e,customerNewsletterSignupError:null,customerNewsletterSignupSuccess:null,isCustomerNewsletterSignupSubmitting:!1}))),e(ee.cf.setEmbedded,((e,t)=>{let{value:r}=t;return{...e,isEmbedded:r}}))])),Tt=e=>(0,L.VP)("[products on page] update product",{product:e}),Lt=(0,ue.combineReducers)({allIds:(0,L.vy)(xe.allIds,(e=>[e(Tt,((e,t)=>{let{product:r}=t;return e.includes(r.id)?e:e.concat(r.id)}))])),byId:(0,L.vy)(xe.byId,(e=>[e(Tt,((e,t)=>{let{product:{id:r,price:i}}=t;return{...e,[r]:{...e[r],id:r,price:i}}}))]))});var qt=r(1885);const Vt=(0,L.vy)(Be,(e=>[e(qt.Ui,((e,t)=>{let{values:r}=t;return{...e,emailForm:{...e.emailForm,values:{...e.emailForm.values,...r}}}})),e(qt.nu,(e=>({...e,emailForm:{...e.emailForm,submitting:!0}}))),e(qt.DL,(e=>({...e,emailForm:{...e.emailForm,submitting:!1,submitSuccess:!0,values:{...e.emailForm.values,recipients:""}}}))),e(qt.qZ,(e=>({...e,emailForm:{...e.emailForm,submitting:!1,submitSuccess:!1}})))]));var Wt=r(5777),Ot=r(6228);const Ut=(0,L.vy)(Ge,(e=>[e(j.hj,((e,t)=>{let{id:r}=t;return{...e,redeemRewardModalOpenFor:r}})),e(j.fM,(e=>({...e,redeemRewardModalClosing:!0}))),e(j.W9,(e=>Nt(e))),e(u.U,(e=>({...Nt(e),customRewardDescriptionModalOpenFor:null}))),e(j.dy,((e,t)=>{let{id:r}=t;return{...e,customRewardDescriptionModalOpenFor:r}})),e(j.D4,(e=>({...e,customRewardDescriptionModalOpenFor:null}))),e(j.Xw,((e,t)=>{let{id:r}=t;return{...e,redeemingRewardFor:r}})),e(j.VX,((e,t)=>{const r=e.redeemRewardErrors[t.id],i=r&&(0,K.oM)(r.name)?{...r,affectedVariants:[...r.affectedVariants??[],...t.error.affectedVariants??[]]}:t.error;return{...e,redeemRewardErrors:{...e.redeemRewardErrors,[t.id]:i},redeemingRewardFor:null}})),e(j.Ys,((e,t)=>({...e,redeemRewardErrors:{...e.redeemRewardErrors,[t.id]:void 0},redeemRewardSuccess:t,redeemingRewardFor:null}))),e(j.A1,((e,t)=>{let{id:r}=t;const i=e.redeemRewardErrors[r];return{...e,redeemRewardErrors:Dt(e,{id:r},i),redeemRewardSuccess:null,redeemingRewardFor:null}})),e(j.f0,((e,t)=>{const r=e.redeemRewardErrors[t.id];return{...e,redeemRewardErrors:Dt(e,t,r),redeemRewardSuccess:t,redeemingRewardFor:null}})),e(j.ws,((e,t)=>{let{id:r}=t;return{...e,redeemRewardErrors:{...e.redeemRewardErrors,[r]:void 0},redeemRewardSuccess:null,redeemingRewardFor:null}})),e(j.UD,((e,t)=>{let{id:r}=t;return{...e,apply:(0,L.rg)(e.apply,r,(e=>({...e,isApplying:!0})),Wt.z)}})),e(j.HK,((e,t)=>{let{id:r}=t;return{...e,apply:(0,L.rg)(e.apply,r,(e=>Wt.z),Wt.z)}})),e(j.P6,((e,t)=>{let{id:r,canBeApplied:i}=t;return{...e,apply:(0,L.rg)(e.apply,r,(e=>({...e,canBeApplied:i})),Wt.z)}})),e(j._m,((e,t)=>{let{id:r,applyResult:i}=t;return{...e,apply:(0,L.rg)(e.apply,r,(e=>({...e,applyResult:i,isApplying:!1})),Wt.z)}}))]));function Dt(e,t,r){return{...e.redeemRewardErrors,[t.id]:r&&(0,K.oM)(r.name)?r:void 0}}function Nt(e){const t=e.redeemRewardErrors,r=e.redeemRewardModalOpenFor;return{...e,redeemRewardErrors:(e=>{if(null===r||!t[r])return e;const i=t[r]?.name;return i&&((0,K.oM)(i)||(0,Ot.Tl)(i))?e:{...e,[r]:void 0}})(t),redeemRewardModalOpenFor:null,redeemRewardSuccess:null,redeemRewardModalClosing:!1}}const Bt=(0,L.vy)(Ye,(e=>[e(q,((e,t)=>{let{revision:r}=t;return{...e,revision:r}})),e(V,((e,t)=>{let{build:r}=t;return{...e,build:r}}))])),Ht=(0,L.vy)(null,(e=>[e(W,((e,t)=>{let{authPacket:r}=t;return r}))]));var xt=r(3917),$t=r(3120);const zt=(0,L.vy)(null,(e=>[e(O.hv,((e,t)=>{let{customer:r}=t;return{...r,actions:r.actions.concat().map((e=>({...e,id:e.id||T.u.v4()}))),claimedRewards:r.claimedRewards.concat().sort(((e,t)=>new Date(t.claimed_at).getTime()-new Date(e.claimed_at).getTime()))}})),e(O.NN,((e,t)=>{let{points:r}=t;if(!e)throw new $t.a("Cannot set points without a customer");return{...e,...r}})),e(O.Gk,((e,t)=>{let{customer:r}=t;if(!e)throw new $t.a("UpdateCustomer requires a set customer first");return i=e,n=r,{...i,...n,actions:n.actions?n.actions.concat(i.actions):i.actions,claimedRewards:n.claimedRewards?n.claimedRewards.concat(i.claimedRewards).sort(((e,t)=>new Date(t.claimed_at).getTime()-new Date(e.claimed_at).getTime())):i.claimedRewards,completedRules:n.completedRules?n.completedRules.concat(i.completedRules):i.completedRules,pendingNotifications:n.pendingNotifications?n.pendingNotifications.concat(i.pendingNotifications):i.pendingNotifications,ruleContext:n.ruleContext?(0,xt.rI)(i.ruleContext,n.ruleContext):i.ruleContext};var i,n})),e(O.CP,((e,t)=>{let{action:r}=t;if(!e)throw new $t.a("UpdateCustomer requires a set customer first");return{...e,actions:[r,...e.actions]}})),e(O.ih,((e,t)=>{let{claimedReward:r}=t;if(!e)throw new $t.a("UpdateCustomer requires a set customer first");return{...e,claimedRewards:[r,...e.claimedRewards]}})),e(O.E2,((e,t)=>{let{claimedReward:r}=t;if(!e)throw new $t.a("UpdateCustomer requires a set customer first");return{...e,claimedRewards:e.claimedRewards.map((e=>e.id===r.id?r:e))}})),e(O.L6,((e,t)=>{let{completedRule:r}=t;if(!e)throw new $t.a("UpdateCustomer requires a set customer first");return{...e,completedRules:[r,...e.completedRules]}}))]));const jt=(0,L.vy)(Xe,(e=>[e(U.L,((e,t)=>{let{translations:r}=t;return{...e,translations:r}}))]));var Jt=r(6067);const Qt=(0,L.vy)(ze,(e=>[e(Jt.XG,((e,t)=>{let{sdkState:r}=t;return{...e,twitterSdk:r}})),e(Jt.Wb,((e,t)=>{let{sdkState:r}=t;return{...e,facebook:{...e.facebook,sdkState:r}}})),e(Jt.Xw,((e,t)=>{let{addresses:r}=t;return{...e,recharge:{...e.recharge,addresses:r}}})),e(Jt._V,((e,t)=>{let{error:r}=t;return{...e,recharge:{...e.recharge,error:r}}}))]));var Yt=r(7586);const Kt=(0,ue.combineReducers)({allIds:(0,L.vy)(He.allIds,(e=>[e(D.z8,((e,t)=>{let{notification:r}=t;return e.includes(r.id)?e:[...e,r.id]})),e(D.fP,((e,t)=>{let{id:r}=t;return e.filter((e=>e!==r))})),e(D.SP,(()=>[]))])),byId:(0,L.vy)(He.byId,(e=>[e(D.z8,((e,t)=>{let{notification:r}=t;return{...e,[r.id]:r}})),e(D.VR,((e,t)=>{let{notification:r}=t;return(0,Yt.HP)(e).includes(r.id)?{...e,[r.id]:r}:e})),e(D.fP,((e,t)=>{let{id:r}=t;const{[r]:i,...n}=e;return n})),e(D.SP,(()=>({})))]))}),Gt=(0,L.vy)(null,(e=>[e(N.i.update,((e,t)=>{let{program:r}=t;return r})),e(N.i.addRule,((e,t)=>{let{rule:r}=t;return e?{...e,rules:[...e.rules,r]}:null}))]));var Xt=r(7655);const Zt=(0,L.vy)(Ke,(e=>[e(Xt.R5,(e=>({...e,...Ke,isFetching:!0}))),e(Xt.N9,((e,t)=>{let{error:r}=t;return{...e,isFetching:!1,error:r}})),e(Xt.VP,((e,t)=>{let{code:r}=t;return{...e,isFetching:!1,value:r}}))]));var er=r(6942);const tr=(0,L.vy)($e,(e=>[e(er.Ih,((e,t)=>{let{open:r}=t;return{...e,isModalOpen:r}})),e(er.Rb,(e=>({...e,isModalOpen:!1}))),e(er.gd,((e,t)=>{let{open:r}=t;return{...e,isDiscountAppliedModalOpen:r}})),e(u.U,(e=>({...e,isModalOpen:!1,isDiscountAppliedModalOpen:!1}))),e(er.K7,((e,t)=>{let{referralBlocked:r}=t;return{...e,referralBlocked:r}}))])),rr=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ze;return{...e,customer:null,authPacket:null,integrations:{...e.integrations,recharge:{}},loyaltyPanel:{...e.loyaltyPanel,customerBirthdaySubmitError:null,customerNewsletterSignupError:null,customerNewsletterSignupSuccess:null,historyInfoModalOpenFor:null,isCustomerBirthdaySubmitSuccess:!1,isCustomerBirthdaySubmitting:!1,isCustomerNewsletterSignupSubmitting:!1,isPendingPointsHelpModalOpen:!1,ruleActionModalOpenFor:null,isReferralWidgetModalOpen:!1,triggeredRuleError:[],triggeredRuleRequesting:[],triggeredRuleSuccess:[]},notifications:{allIds:[],byId:{}},page:{...e.page,initData:{token:e.page.initData?.token,auth:void 0,customer:void 0}},referralWidget:Ze.referralWidget,rewards:{customRewardDescriptionModalOpenFor:null,isRewardDescriptionModalOpen:!1,redeemingRewardFor:null,redeemRewardErrors:{},redeemRewardModalOpenFor:null,redeemRewardModalClosing:!1,redeemRewardSuccess:null,apply:{}},shopify:{...Ze.shopify},appTurnkey:{...Ze.appTurnkey,customisations:e.appTurnkey.customisations,clientConfig:e.appTurnkey.clientConfig}}},ir=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ze,t=arguments.length>1?arguments[1]:void 0;return{...e,...t}},nr=(0,L.vy)(je,(e=>[e(H.Bo,((e,t)=>{let{cart:r}=t;return{...e,cart:r}})),e(H.oN,((e,t)=>{let{variants:r}=t;return{...e,cartRewardVariants:r}})),e(H.kK,((e,t)=>{let{variant:r}=t;return{...e,cartRewardVariants:[...e.cartRewardVariants,r]}})),e(H.B0,((e,t)=>{let{variant:r}=t;return{...e,cartRewardVariants:e.cartRewardVariants.filter((e=>e.id!==r.id))}})),e(H.gO,((e,t)=>{let{redemptions:r}=t;return{...e,shopifyScriptRedemptions:r}})),e(H.Mz,((e,t)=>{let{redemption:r}=t;return{...e,shopifyScriptRedemptions:[...e.shopifyScriptRedemptions,r]}})),e(H.tF,((e,t)=>{let{redemption:r}=t;return{...e,shopifyScriptRedemptions:e.shopifyScriptRedemptions.filter((e=>e.id!==r.id))}})),e(H.BB,((e,t)=>{let{redemptions:r}=t;return{...e,shopifyFunctionRedemptions:r}})),e(H.pv,((e,t)=>{let{redemption:r}=t;return{...e,shopifyFunctionRedemptions:[...e.shopifyFunctionRedemptions,r]}})),e(H.od,((e,t)=>{let{redemption:r}=t;return{...e,shopifyFunctionRedemptions:e.shopifyFunctionRedemptions.filter((e=>e.id!==r.id))}})),e(H.HZ,((e,t)=>{let{value:r}=t;return{...e,onThankYou:r}})),e(H.vL,((e,t)=>{let{currency:r}=t;return{...e,localCurrency:r}})),e(H.Gk,(e=>({...e,localCurrencyFailedAttempts:e.localCurrencyFailedAttempts+1}))),e(H.C5,(e=>({...e,localCurrencyFailedAttempts:0}))),e(H.sk,(e=>({...e,buyWithPointsStatus:"started"}))),e(H.aK,(e=>({...e,buyWithPointsStatus:"stopped"}))),e(H.LL,(e=>({...e,buyWithPointsManagerStatus:"started",buyWithPointsStatus:"started"===e.freeVariantManagerStatus?"started":e.buyWithPointsStatus}))),e(H.t2,(e=>({...e,freeVariantManagerStatus:"started",buyWithPointsStatus:"started"===e.buyWithPointsManagerStatus?"started":e.buyWithPointsStatus}))),e(H.f4,(e=>({...e,buyWithPointsManagerStatus:"stopped",buyWithPointsStatus:"stopped"}))),e(H.nA,(e=>({...e,freeVariantManagerStatus:"stopped",buyWithPointsManagerStatus:"stopped"}))),e(H.xd,((e,t)=>{let{frontend:r}=t;return{...e,frontend:r}}))]));var or=r(1542);const sr=(0,L.vy)(null,(e=>[e(x.Qn,((e,t)=>{let{site:r}=t;return r})),e(x.hj,((e,t)=>{let{site:r}=t;return e?{...e,...r}:null})),e(x.pL,((e,t)=>{let{locale:r}=t;return e?{...e,settings:{...e.settings,locale:{...e.settings.locale,primary:r}}}:null})),e(x.Jv,((e,t)=>{let{sections:r}=t;return e?{...e,settings:{...e.settings,integratedLoyaltyPage:{...e.settings.integratedLoyaltyPage,sections:r}}}:null})),e(x.J,((e,t)=>e?{...e,themeConfiguration:t}:null)),e(x.Tp,((e,t)=>e?.themeConfiguration?{...e,themeConfiguration:(0,or.P)((0,Yt.jO)(e.themeConfiguration).map((e=>{let[r,i]=e;return[r,{...i,...t[r]}]})))}:null)),e(x.qf,((e,t)=>e?{...e,siteThemeContent:t}:null))])),ar=(0,ue.combineReducers)({app:at,api:Bt,authPacket:Ht,browser:qe.f,checkoutRedemption:It,clientConfiguration:Oe,customer:zt,controlMode:v.Zx,emailTracking:Le,hooks:Ue.do,integrations:Qt,isLoyaltySplashOrPanelModalOpen:Et,loyaltyPanel:Ft,notifications:Kt,page:De.ko,productsOnPage:Lt,program:Gt,referralWidget:Vt,referred:tr,refereeIncentiveCode:Zt,rewards:Ut,shopify:nr,site:sr,appTurnkey:Ee,i18n:jt}),cr=(e,t)=>{switch(t.type){case B.c.RemoveCustomer:return rr(e);case B.c.ChangeState:return ir(e,t.payload);default:return ar(e,t)}};var lr=r(6298);var dr=r(5376);const ur=function({sentry:e,actionTransformer:t=(e=>e),stateTransformer:r=(e=>e),configureSentryWithState:i}){return n=>(o,s)=>n(((n,s)=>{const a=o(n,s),c=t(s),l=r(a);return c&&e.addBreadcrumb({category:"redux.action",type:"info",data:c}),e.setContext("redux.state",l||null),null==i||i(e,a,s),a}),s)}({sentry:dr.e$,stateTransformer:e=>function(e){const{customer:t,site:r,program:i}=e;return{...e,customer:t?(0,Yt.Up)(t,["id"]):null,site:r?(0,Yt.Up)(r,["id"]):null,program:i?(0,Yt.Up)(i,["id"]):null}}(e),actionTransformer:e=>function(e){switch(e.type){case pr.type:return{...e,payload:{site:(0,Yt.Up)(e.payload.site,["id","domain"])}};case gr.type:return{...e,payload:{program:(0,Yt.Up)(e.payload.program,["id","name"])}};case hr.type:return{...e,payload:{customer:(0,Yt.Up)(e.payload.customer,["id"])}};default:return e}}(e),configureSentryWithState(e,t,r){!function(e){switch(e.type){case pr.type:return function(e){const t={...e,settings:(0,Yt.cJ)(e.meta,["loyaltyPanelCustomisationDigest","legacyUiMigration","preThemeEditorOverrides"])};dr.e$.setContext("site",t),dr.e$.setTags({"site.id":e.id,"site.token":e.token,"site.domain":e.domain,"site.platform":e.platform,"site.role":e.role,"site.ui_mode":e.uiMode})}(e.payload.site);case gr.type:return function(e){dr.e$.setContext("program",e),dr.e$.setTags({"program.id":e.id})}(e.payload.program);case hr.type:return fr(e.payload.customer);case mr.type:return fr(null);default:;}}(r)}}),pr=(0,L.yi)(x.Qn),hr=(0,L.yi)(O.hv),mr=(0,L.yi)(B.a.removeCustomer),gr=(0,L.yi)(N.i.update);function fr(e){const t=e?{...(0,Yt.cJ)(e,["firstName","fullName","birthday","actions","claimedRewards"]),properties:(0,Yt.Up)(e.properties,["rechargeHash"]),pendingNotifications:e.pendingNotifications.slice(0,10)}:null;dr.e$.setContext("customer",t),dr.e$.setUser(e?{id:e.id.toString()}:null),dr.e$.setTags({"customer.id":e?.id,"customer.merchant_id":e?.merchantId,"customer.enrolled":e?.enrolled,"customer.blocked":e?.blocked,"customer.guest":e?.guest})}const yr=[e=>{let{dispatch:t,getState:r}=e;return e=>i=>{if("function"==typeof i)try{const e=i(t,r);return n=e,Boolean(n&&"function"==typeof n.then)?e.catch((e=>{y.v.error("Thunk Error: ",{err:e,state:r()})})):e}catch(e){return y.v.error("Thunk Error: ",{err:e,state:r()}),e}var n;return e(i)}},e=>{let{getState:t}=e;return e=>r=>{try{return e(r)}catch(e){return y.v.error(`Reducer Error: ${e.message}`,{err:e,state:t()}),e}}},h.Ay];r(9332);var vr=r(9291),wr=r(737),br=r(1551),Ar=r(7932),Sr=r(8733),Rr=r(9166),kr=r(3575),Cr=r(6048),Pr=r(961),Mr=r(4802),Ir=r(9102),_r=r(3424);class Er{async start(){"not_started"===this.getManagerStatus()&&this.buyWithPointsEnabled()&&((0,te.L4)(this.getState())?(0,kr.B)(this.getState())?(await this.fetchRedemptionsForCart(),await this.cancelMissingRewardLineItems(),await this.cleanShopifyCart(),this.unsubscribe=I(this.store,((e,t)=>{const r=(0,Cr.J1)(e),i=t&&(0,Cr.J1)(t);r!==i&&this.onCartUpdate(i,r).catch((e=>{y.v.error("failed to handle cart update",{err:e}),this.stopBuyWithPoints()}))})),this.store.dispatch((0,H.LL)())):this.stopBuyWithPoints():await this.removeLineItemsFromCartAndReload(this.getLineItemsWithDiscountProperty()))}async onCartUpdate(e,t){if("started"===this.getManagerStatus()){if(!t)throw new Rr.g("BuyWithPoints onCartUpdate requires at least a newCart");e&&_.F$.cartsEqual(e,t)||(await this.cancelMissingRewardLineItems(),await this.cleanShopifyCart())}}async cleanShopifyCart(){if(0===this.getCart().items.length)return;const e=this.getLineItemsToRemove();if(0!==e.length){for(const t of e){const e=Lr(t,this.getState());e&&await this.cancelRedemption(e)}await this.removeLineItemsFromCartAndReload(e)}}getLineItemsToRemove(){if(0===this.getCart().items.length)return[];if((0,m.J)(this.getState())&&!_.F$.cartHasPaidItems(this.getCart()))return this.getLineItemsWithDiscountProperty();const e=[...this.getUnexpectedRewardLineItems(),...this.getDuplicateRewardLineItems()];return(0,m.SP)(this.getState())&&e.push(...this.getItemsToRemoveToBalanceCart()),(0,xt.hS)(e,(e=>e.key))}async fetchRedemptionsForCart(){try{await this.getLionApi().customers.fetchShopifyScriptProductRedemptions({cartIdentifier:this.getCart().token}),await this.getLionApi().customers.fetchShopifyFunctionRedemptions()}catch(e){y.v.error("Error fetching redemptions for cart",{err:e}),this.stopBuyWithPoints()}}async cancelMissingRewardLineItems(){const e=(0,Cr.ir)(this.getState()),t=this.getLineItemsWithDiscountProperty();for(const r of e){t.some((e=>Fr(e,(0,Ir.ew)(r)?r.identifier:r.metadata.encodedContext)))||await this.cancelRedemption(r)}}getUnexpectedRewardLineItems(){const e=this.getLineItemsWithDiscountProperty(),t=(0,Cr.ir)(this.getState()).map((e=>(0,Ir.ew)(e)?e.identifier:e.metadata.encodedContext));return e.filter((e=>{const r=Tr(e);return!t.includes(r??"")}))}getDuplicateRewardLineItems(){const e=this.getLineItemsWithDiscountProperty(),t=e.reduce(((e,t)=>{const r=Tr(t);return r?(e[r]=e[r]?e[r]+t.quantity:t.quantity,e):e}),{});return e.filter((e=>{const r=Tr(e);return!!r&&t[r]>1}))}getItemsToRemoveToBalanceCart(){const e=[];let t=(0,Mr.I)(this.getState());if(t>=0)return e;const r=this.getLineItemsWithValidRedemptions();for(const{line:i,redemption:n}of r){const r=(0,Pr.QJ)(n,this.getCart(),this.getState());if(y.v.info(`Removing inCartReward line item (variantId: ${n.product.variantId}) as instant-points balance no longer covers cost.`),e.push(i),t+=r,t>=0)return e}return e}getLineItemsWithValidRedemptions(){return this.getLineItemsWithDiscountProperty().map((e=>{const t=Lr(e,this.getState());return t?{redemption:t,line:e}:null})).filter((e=>!!e))}getLineItemsWithDiscountProperty(){return this.getCart().items.filter(_.F$.lineHasProductDiscountProperty)}async cancelRedemption(e){(0,Ir.ew)(e)?await this.cancelShopifyFunctionRedemptionUsage(e):await this.cancelShopifyScriptRedemptionUsage(e)}async cancelShopifyScriptRedemptionUsage(e){for(const t of e.usages.filter((e=>"claimed"===e.status)))await this.getLionApi().customers.cancelShopifyScriptProductRedemptionUsage({usageId:t.id});this.store.dispatch((0,H.tF)(e))}async cancelShopifyFunctionRedemptionUsage(e){for(const t of e.usages.filter((e=>"active"===e.status)))await this.getLionApi().customers.cancelShopifyFunctionRedemptionUsage({usageId:t.id});this.store.dispatch((0,H.od)(e))}async removeLineItemsFromCartAndReload(e){if(0===e.length)return;const t=await _.LQ.removeItemsFromCart(e);if(!t)return y.v.error("Stopped buy with points - lost cart"),void this.stopBuyWithPoints();this.store.dispatch((0,H.Bo)(t)),(0,f.I)({event:"cart.removedItems",payload:e}),(0,f.I)({event:"cart.changed"}),f.P.listenerCount("cart.changed")>0||f.P.listenerCount("cart.removedItems")>0||window.location.reload()}stopBuyWithPoints(){this.unsubscribe?.(),this.store.dispatch((0,H.f4)())}getState(){return this.store.getState()}getCart(){const e=(0,Cr.J1)(this.getState());if(!e)throw new Rr.g("");return e}getManagerStatus(){return(0,_r.LP)(this.getState())}buyWithPointsEnabled(){return!(0,w.vy)(this.getState())&&(0,K.f7)(this.getState()).length>0}getLionApi(){return d.H.buildFromState(this.getState(),this.store.dispatch)}constructor(e){this.store=e}}function Fr(e,t){const r=Tr(e);return!!r&&r===t}function Tr(e){return e.properties?e.properties[Sr.v]||e.properties[Sr.M]:null}function Lr(e,t){return(0,Cr.ir)(t).find((t=>Fr(e,(0,Ir.ew)(t)?t.identifier:t.metadata.encodedContext)))??null}var qr=r(1668);class Vr extends Error{constructor(...e){super(...e),this.name="NoShopifyCartVariantsError"}}class Wr{async start(){"not_started"===this.getStatus()&&this.buyWithPointsEnabled()&&((0,te.L4)(this.state)?(await this.fetchOwnedFreeProductVariants(),await this.cancelMissingRewardLineItems(),await this.cleanShopifyCart(),this.unsubscribe=I(this.store,((e,t)=>{const r=(0,Cr.J1)(e),i=t&&(0,Cr.J1)(t);r!==i&&this.onCartUpdate(i,r).catch((e=>{y.v.error("failed to handle cart update",{err:e}),this.stopBuyWithPoints()}))})),this.store.dispatch((0,H.t2)())):await this.removeLineItemsFromCartAndReload(this.cartRewardLineItems))}async onCartUpdate(e,t){if("started"===this.getStatus()){if(!t)throw new Rr.g("BuyWithPoints onCartUpdate requires at least a newCart");e&&_.F$.cartsEqual(e,t)||(await this.cancelMissingRewardLineItems(),await this.cleanShopifyCart())}}buyWithPointsEnabled(){return!(0,w.vy)(this.store.getState())&&(0,K.f7)(this.state).length>0}async fetchOwnedFreeProductVariants(){const e=await this.api.customers.fetchFreeProductVariants(this.cart.token);if(!("error"in e))return e.variants;y.v.error("Error fetching free product variants for cart",{cartToken:this.cart.token,apiError:e.error}),this.stopBuyWithPoints()}async cancelVariant(e){if(!this.cartVariants.map((e=>e.variant_id)).includes(e.toString(10)))return;const t=await this.api.customers.cancelFreeProductVariant(e);"error"in t&&y.v.error(`Error cancelling reward variant: ${e}, message: ${t.error.message??""}`)}async cleanShopifyCart(){if(0===this.cart.items.length)return;const e=[];if((0,m.J)(this.state)&&!_.F$.cartHasPaidItems(this.cart)&&e.push(...this.cartRewardLineItems),e.push(...this.getUnownedCartVariants()),(0,m.SP)(this.state)&&e.push(...this.getItemsToRemoveToBalanceCart()),e.length>0){const t=(0,xt.hS)(e,(e=>e.variant_id));await this.cancelRewardLineItems(t),await this.removeLineItemsFromCartAndReload(t)}}stopBuyWithPoints(){this.unsubscribe?.(),this.store.dispatch((0,H.nA)())}getStatus(){return(0,_r.HH)(this.store.getState())}getUnownedCartVariants(){const e=this.cartVariants.map((e=>e.variant_id));return this.cartRewardLineItems.filter((t=>!e.includes(t.variant_id.toString(10))))}getItemsToRemoveToBalanceCart(){const e=[];let t=(0,Mr.I)(this.state);if(t<0)for(const r of this.cartRewardLineItems){if(!r.variant_id)continue;const i=this.cartVariants.find((e=>e.variant_id===r.variant_id.toString(10))),n=(0,K.K5)(this.state,i?.base_variant_id);if(n&&(y.v.info(`Removing inCartReward line item (variantId: ${r.variant_id}) as instant-points balance no longer covers cost.`),e.push(r),t+=n.point_cost,t>=0))return e}return e}async cancelMissingRewardLineItems(){const e=this.cart.items.map((e=>e.variant_id.toString(10))),t=this.cartVariants;for(const r of t)e.includes(r.variant_id)||(y.v.info(`Deleting variant: ${r.variant_id} because it is no longer in cart`),await this.cancelVariant((0,qr.bz)(r.variant_id)))}async cancelRewardLineItems(e){for(const t of e)await this.cancelVariant(t.variant_id)}async removeLineItemsFromCartAndReload(e){if(0===e.length)return;if(!await _.LQ.removeItemsFromCart(e))return y.v.error("Stopped buy with points - lost cart"),void this.stopBuyWithPoints();this.emitItemsRemoved(e),f.P.listenerCount("cart.changed")||f.P.listenerCount("cart.removedItems")||window.location.reload()}emitItemsRemoved(e){(0,f.I)({event:"cart.removedItems",payload:e}),(0,f.I)({event:"cart.changed"})}get cartRewardLineItems(){const e=this.cart.items,t=(0,K.f7)(this.state);return e.filter((e=>/Reward #/.test(e.variant_title??""))).filter((e=>t.some((t=>t.target_products.some((t=>t.id===e.product_id))))))}get cartVariants(){const e=(0,Cr.aT)(this.state);if(!e)throw new Vr("Shopify Cart Variants required for Buy With Points");return e}get cart(){const e=(0,Cr.J1)(this.state);if(!e)throw new Rr.g("");return e}get state(){return this.store.getState()}get api(){return d.H.buildFromState(this.state,this.store.dispatch)}constructor(e){this.store=e}}var Or=r(6083),Ur=["earn","rewards","refer","tiers","history","help"];const Dr=["redeem","account"];function Nr(e){const t=e.toLowerCase();if(function(e){return Dr.includes(e)}(t))switch(t){case"account":return"history";case"redeem":return"rewards"}return function(e){return(0,Or.mK)(Ur,e)}(t)?t:null}const Br=[{name:"refer"},{name:"account-link"}],Hr=[{name:"checkoutSlider"},{name:"loyaltyWidget"}],xr=[{name:"account"},{name:"history-table",requiresFeature:"sdkComponentAdvanced"},{name:"claimed-rewards-list",requiresFeature:"sdkComponentAdvanced"},{name:"points",requiresCustomer:!0},{name:"points-for"},{name:"points-for-id"},{name:"points-for-product-id"},{name:"points-for-rule"},{name:"referral-url",requiresCustomer:!0},{name:"rewards-list",requiresFeature:"sdkComponentAdvanced"},{name:"rules-list",requiresFeature:"sdkComponentAdvanced"},{name:"seamless-product-reward",requiresCustomer:!0},{name:"seamless-product-reward-widget",requiresCustomer:!0,requiresFeature:"sdkComponentInCartRewards"},{name:"current-tier-name"},{name:"tier-overview"},{name:"tier-benefits-compare"},{name:"tier-rewards-compare"},{name:"tier-rules-compare"},{name:"tier-progress",requiresCustomer:!0},{name:"powered-by"},{name:"integrated-page",requiresFeature:"integratedPage"},{name:"integrated-page-section",requiresFeature:"integratedPage"},{name:"app-styles"}];function $r(e){const t=[...Hr,...xr];return(0,xt.qI)(t,(t=>"requiresCustomer"in t&&!e?null:zr(t,{removeChildren:!0}))).filter(C.R)}function zr(e){let{removeChildren:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=`data-lion-${e.name}`,i=`*[${r}]`,n=document.querySelectorAll(i);return(0,Or.A6)(n).map((i=>(t&&(i.innerHTML=""),{definition:e,element:i,attribute:i.getAttribute(r)??""})))}class jr{scan(){const e=[];(0,xt.qI)(Br,(e=>zr(e))).filter(C.R).forEach((t=>{this.isAlreadyAugmented(t.element)||(!function(e,t){const{attribute:r,element:i,definition:n}=e;switch(i&&i instanceof Element||y.v.error(`Invalid attempt to augment element: ${i} for selector: ${r}`,{augmentationElement:e}),n.name){case"refer":i.addEventListener("click",(e=>{e.preventDefault(),t.dispatch((0,ee.N6)())}));break;case"account-link":{const e=Nr(r),n=i.getAttribute("href");if("string"==typeof n&&"#"!==n){if(n.includes("i.thechive.com"))break;y.v.warn("You have attached a `data-lion-account-link` handler to a link which already has a `href` attribute. This is not recommended because the link will react differently before LoyaltyLion finishes loading. Remove the `href` attribute or set it to `#` instead.",{element:i})}i.addEventListener("click",(r=>{r.preventDefault(),e&&t.dispatch((0,ee.yd)(e)),t.dispatch((0,_t.M)())}));break}default:y.v.error(`No augmentation found for: ${r}`,{augmentationElement:e})}}(t,this.store),this.augmentedElements.push(t.element),e.push(t))})),M.q.trackPageComponent(e,(0,g.Gd)(this.store.getState()).id)}isAlreadyAugmented(e){return this.augmentedElements.some((t=>t.isSameNode(e)))}constructor(e){this.store=e,this.augmentedElements=[],this.scan()}}function Jr(e,t){const r=function(e){const t=e.match(/^-+(.*)$/)??e.match(/^(.*)-+$/);if(t)return{isNegative:!0,num:t[1]};return{isNegative:!1,num:e}}(e=(e+"").replace(/[^\d,.-]/g,""));r.num.match(/[.|,]$/)&&(e=r.num.slice(0,-1));const i=function(e,t){let r=e.match(/\D/g)??[];switch(r=r.filter(((e,t)=>r.indexOf(e)===t)),r.length){case 0:return e?`${e}00`:null;case 2:{const t=r[0],i=r[1],n=e.split(t).join("");return`${n.split(i)[0]}${n.split(i)[1]||"00"}`}case 1:return function(e,t,r){if(e.split(t).length>2)return`${e.split(t).join("")}`;const i=e.split(t)[0],n=e.split(t)[1];if(3!==n.length||i.length>3||t===r.decimalSeparator)return`${i}${n}`;return`${i}${n}00`}(e,r[0],t);default:return null}}(e,t);return i?r.isNegative?-1*Number(i):Number(i):null}const Qr={pointsFor:"data-lion-points-for",pricesForProduct:["data-lion-price-for-product-id","data-lion-points-price"]};class Yr{scan(){(0,ce.G_)(this.store.getState())&&document.querySelectorAll(Qr.pricesForProduct.map((e=>`*[${e}]`)).join(", ")).forEach((e=>{this.upsertProductFromElement(e),this.isAlreadyObserved(e)||this.observeElement(e)}))}observeElement(e){if("function"!=typeof MutationObserver)return;new MutationObserver((()=>{this.upsertProductFromElement(e)})).observe(e,{childList:!0}),this.observedElements.push(e)}upsertProductFromElement(e){const t=function(e,t){const r=function(e,t){return e.textContent?Jr(e.textContent,t):null}(e,t),i=function(e){for(const t of Qr.pricesForProduct){const r=e.getAttribute(t);if(r)return r}return null}(e);return r&&i?{price:r,id:i}:null}(e,this.currency);t&&this.store.dispatch(Tt(t))}isAlreadyObserved(e){return this.observedElements.some((t=>t.isSameNode(e)))}get currency(){return(0,g.yl)(this.store.getState())}constructor(e){this.store=e,this.observedElements=[],this.scan()}}var Kr=r(2668),Gr=r(7024),Xr=r(8795),Zr=r(1657),ei=r(330),ti=r(7881),ri=r(7366),ii=r(9331);const ni=2e3;class oi{async start(){y.v.debug("[ShopifyCheckoutRedemptionManager#start]");const{dispatch:e}=this.store,t=function(){const e=window.Shopify?.Checkout&&"string"==typeof window.Shopify.Checkout.token?window.Shopify.Checkout.token:null;if(!e)throw new Kr.I("Shopify checkout token not found");return e}();y.v.debug("[ShopifyCheckoutRedemptionManager#start]",{checkoutToken:t}),e(Mt.Rd.setInputMode((0,A.eQ)(ri.Ey)?"select":"slider")),e(Mt.Rd.setShopifyCheckoutToken(t)),await this.waitForCart();const r=(0,Cr.J1)(this.store.getState());return y.v.debug("[ShopifyCheckoutRedemptionManager#start]",{cart:r}),r&&await this.setCartAndEligibleLineItems(r).catch((e=>{y.v.error("failed to setCartAndEligibleLineItems",{err:e})})),this.watchForCartChanges(),await async function(e){if("function"!=typeof MutationObserver)throw new Kr.I("MutationObserver unsupported");const t=await(0,Xr.xk)(ri.rW.orderSummary,ni);if(!t)throw new Kr.I("Order summary not found");new MutationObserver(e).observe(t,{childList:!0})}((0,l.s)(500,this.refresh,{atBegin:!1})),this.checkForActiveRedemption(t),this.refresh(),async function(){y.v.debug("[ShopifyCheckoutRedemptionManager#createRedemptionSection] start");const e=await(0,Xr.xk)(ri.rW.discountSection,ni);if(!e?.parentNode)throw new Kr.I("Discount section not found");const t=document.createElement("div");return t.className=[ri.vq.section,`${ri.vq.section}--redemption`].join(" "),e.parentNode.insertBefore(t,e),t}()}setEligibleTotalForDiscount(){y.v.debug("[ShopifyCheckoutRedemptionManager#setEligibleTotalForDiscount] start");const e=this.getEligibleSubtotal();if(y.v.debug("[ShopifyCheckoutRedemptionManager#setEligibleTotalForDiscount]",{subtotal:e}),null===e)return;const t=Math.max(0,e-(0,Or.A6)(document.querySelectorAll(ri.rW.giftCardAmount)).reduce(((e,t)=>{const r=(0,Xr.bT)(t,ri.lL.giftCardAmount);if(!r)return e+0;const i=(0,qr.oV)(r);return null===i||i<=0?e+0:e+i}),0));y.v.debug("[ShopifyCheckoutRedemptionManager#setEligibleTotalForDiscount]",{total:t}),this.store.dispatch(Mt.Rd.setReady()),this.store.dispatch(Mt.Rd.setEligibleTotalForDiscount(t))}getEligibleSubtotal(){return this.cart&&this.eligibleLineItems?0===this.cart.items.length?function(){y.v.debug("[ShopifyCheckoutRedemptionManager#getCheckoutSubtotal] start");const e=document.querySelector(ri.rW.orderSubtotal);if(y.v.debug("[ShopifyCheckoutRedemptionManager#getCheckoutSubtotal]",{element:e}),!e)return null;const t=(0,Xr.bT)(e,ri.lL.orderSubtotal);if(y.v.debug("[ShopifyCheckoutRedemptionManager#getCheckoutSubtotal]",{value:t}),!t)return null;const r=(0,qr.oV)(t);if(y.v.debug("[ShopifyCheckoutRedemptionManager#getCheckoutSubtotal]",{subtotal:r}),null===r||r<=0)return null;return r}():this.eligibleLineItems.reduce(((e,t)=>e+t.line_price),0):null}checkForAppliedRedemption(){y.v.debug("[ShopifyCheckoutRedemptionManager#checkForAppliedRedemption] start");const{code:e,id:t,isApplying:r}=(0,ti.PM)(this.store.getState());r&&t&&e&&si().has(e)&&this.store.dispatch(Mt.Rd.setRedemptionApplied({id:t,code:e}))}checkForRemovedDiscount(){y.v.debug("[ShopifyCheckoutRedemptionManager#checkForRemovedDiscount] start");const{code:e,id:t,isApplying:r}=(0,ti.PM)(this.store.getState());r&&!(0,ii.n5)()||e&&t&&(si().has(e)||this.store.dispatch((0,Mt.$h)(t,(0,ii.n5)()?"slider_invalid":"slider_removed")).then((()=>this.store.dispatch(Mt.Rd.setRedemptionRemoved()))).catch((()=>{})))}watchForCartChanges(){I(this.store,(e=>{const t=(0,Cr.J1)(e);t&&(this.cart&&_.F$.cartsEqual(this.cart,t)||this.setCartAndEligibleLineItems(t).catch((e=>{y.v.error("failed to setCartAndEligibleLineItems",{err:e})})))}))}async waitForCart(){if(this.cart)return void y.v.debug("[ShopifyCheckoutRedemptionManager#waitForCart] cart already present",{cart:this.cart});const e=this.store.getState(),t=e.site?.platform,r=e.shopify.frontend;if("shopify"!==t||"unknown"!==r)return void y.v.debug("[ShopifyCheckoutRedemptionManager#waitForCart] platform is not Shopify or frontend is already known");await new Promise((e=>{y.v.debug("[ShopifyCheckoutRedemptionManager#waitForCart] starting wait loop");const t=setInterval((()=>{y.v.debug("[ShopifyCheckoutRedemptionManager#waitForCart] waiting"),window.Shopify&&(y.v.debug("[ShopifyCheckoutRedemptionManager#waitForCart] window.Shopify is present",{window}),this.store.dispatch((0,H.xd)("shopify")),clearInterval(t),e())}),100)})),y.v.debug("[ShopifyCheckoutRedemptionManager#waitForCart] fetching cart");const i=await(0,Zr.t)();i&&(y.v.debug("[ShopifyCheckoutRedemptionManager#waitForCart] dispatching cart",{cart:i}),this.store.dispatch((0,H.Bo)(i)))}async setCartAndEligibleLineItems(e){try{this.cart=e,this.setSubscriptionAppStatusFromLineItems(e.items),this.eligibleLineItems=await this.filterEligibleLineItems(e.items),y.v.debug("[ShopifyCheckoutRedemptionManager#setCartAndEligibleLineItems]",{cart:e,cartItems:e.items,eligibleLineItems:this.eligibleLineItems}),this.refresh()}catch(e){y.v.error("failed to filter eligible line items",{err:e})}}setSubscriptionAppStatusFromLineItems(e){e.some((e=>e.selling_plan_allocation))&&this.store.dispatch(Mt.Rd.setHasSubscriptionAppInstalled())}async filterEligibleLineItems(e){const{target_collections:t,order_type:r}=this.checkoutReward;let i=e;"one_time"===r&&(i=i.filter((e=>Boolean(!e.selling_plan_allocation))));const n=t.length>0?t[0].id??null:null;if(!n)return i;const o=await this.api.checkoutRedemption.qualifyProductsForCollection({collectionId:n,productIds:i.filter((e=>Boolean(e.product_id))).map((e=>e.product_id))});if("error"in o)return y.v.error("failed to qualify products for collection",{res:o}),i;const s=o.qualifiedProducts.filter((e=>e.inCollection)).map((e=>e.productId));return i.filter((e=>e.product_id&&s.includes(e.product_id)))}checkForActiveRedemption(e){y.v.debug("[ShopifyCheckoutRedemptionManager#checkForActiveRedemption] start");const t=(0,Gr.rX)(this.store.getState()).find((t=>Boolean("approved"===t.state&&t.session.token&&t.session.token===e)));t&&(this.store.dispatch(Mt.Rd.setRedemptionValue(t.redeemable.discount_amount)),this.store.dispatch(Mt.Rd.setRedemptionApplied({id:t.id,code:t.redeemable.code})))}get api(){return d.H.buildFromState(this.store.getState(),this.store.dispatch)}constructor(e){this.store=e,this.refresh=()=>{y.v.debug("[ShopifyCheckoutRedemptionManager#refresh] start"),this.setEligibleTotalForDiscount(),this.checkForAppliedRedemption(),this.checkForRemovedDiscount()},y.v.debug("[ShopifyCheckoutRedemptionManager#constructor]");const t=(0,K.VI)(e.getState());if(y.v.debug("[ShopifyCheckoutRedemptionManager#constructor] checkoutReward",{checkoutReward:t}),!t)throw new Kr.I("No checkout redemption reward");this.checkoutReward=t}}function si(){const e=(0,Or.A6)(document.querySelectorAll(ri.rW.appliedReductionCodes));return new Set(e.filter((e=>null!==e.textContent)).map((e=>ei.T.must(e.textContent))))}var ai=r(8895),ci=r(8100),li=r(9357);var di=new WeakMap,ui=new WeakMap,pi=new WeakSet,hi=new WeakSet,mi=new WeakSet,gi=new WeakSet,fi=new WeakSet,yi=new WeakSet,vi=new WeakSet,wi=new WeakMap,bi=new WeakSet,Ai=new WeakSet,Si=new WeakSet,Ri=new WeakSet,ki=new WeakSet,Ci=new WeakSet,Pi=new WeakSet,Mi=new WeakSet;class UI{get store(){return M.q.trackUndocumentedApiAccess("loyaltylion.ui.store"),(0,i.A)(this,di)}async start(){if(this.started)return this.refresh();s(this,Mi,xi).call(this),s(this,fi,Ti).call(this),s(this,yi,Li).call(this),s(this,vi,qi).call(this),(0,i.A)(this,di).dispatch((0,H.HZ)(_.EO.isOnThankYouPage())),await(0,Xr.Z4)(),this.priceForProductManager=new Yr((0,i.A)(this,di)),this.augmentedElementsManager=new jr((0,i.A)(this,di)),s(this,pi,Ii).call(this),await s(this,ki,Ni).call(this).catch((e=>y.v.error("failed to startShopifyCheckoutRedemption",{err:e}))),s(this,hi,_i).call(this),se((0,i.A)(this,di));try{await s(this,Ai,Oi).call(this)}catch(e){y.v.error("Error when loading shopify-cart-dependent functionality",{err:e})}(0,i.A)(this,di).dispatch((0,D.li)()),this.started=!0}createLoyaltyWidgetPortal(){M.q.trackUndocumentedApiAccess("loyaltylion.ui.createLoyaltyWidgetPortal"),s(this,pi,Ii).call(this)}assertComponents(){M.q.trackUndocumentedApiAccess("loyaltylion.ui.assertComponents"),s(this,hi,_i).call(this)}refresh(e){if(this.rendered)return e?.debounce?(0,i.A)(this,ui).call(this):void s(this,mi,Ei).call(this)}renderApp(e){M.q.trackUndocumentedApiAccess("loyaltylion.ui.renderApp"),s(this,gi,Fi).call(this,e)}openRuleActionModal(e){M.q.trackUndocumentedApiAccess("loyaltylion.ui.openRuleActionModal"),(0,i.A)(this,di).dispatch((0,ee.Iu)(e))}closeRuleActionModal(){M.q.trackUndocumentedApiAccess("loyaltylion.ui.closeRuleActionModal"),(0,i.A)(this,di).dispatch((0,ee.Ze)())}openRedeemRewardModal(e){M.q.trackUndocumentedApiAccess("loyaltylion.ui.openRedeemRewardModal"),(0,Y.E$)((0,i.A)(this,di).getState(),e)&&(0,i.A)(this,di).dispatch((0,j.hj)(e))}closeRedeemRewardModal(){M.q.trackUndocumentedApiAccess("loyaltylion.ui.closeRedeemRewardModal"),(0,i.A)(this,di).dispatch((0,j.pk)())}openHistoryInfoModal(e){M.q.trackUndocumentedApiAccess("loyaltylion.ui.openHistoryInfoModal"),(0,i.A)(this,di).dispatch((0,ee.wd)(e))}closeHistoryInfoModal(){M.q.trackUndocumentedApiAccess("loyaltylion.ui.closeHistoryInfoModal"),(0,i.A)(this,di).dispatch((0,ee.k0)())}openReferralWidgetModal(){M.q.trackUndocumentedApiAccess("loyaltylion.ui.openReferralWidgetModal"),(0,i.A)(this,di).dispatch((0,ee.N6)())}closeReferralWidgetModal(){M.q.trackUndocumentedApiAccess("loyaltylion.ui.closeReferralWidgetModal"),(0,i.A)(this,di).dispatch((0,ee.XS)())}setActiveLoyaltyPanelPage(){M.q.trackUndocumentedApiAccess("loyaltylion.ui.setActiveLoyaltyPanelPage"),s(this,fi,Ti).call(this)}displayFriendReferralWelcomePopUp(){M.q.trackUndocumentedApiAccess("loyaltylion.ui.displayFriendReferralWelcomePopUp"),s(this,yi,Li).call(this)}displayReferralDiscountAppliedModal(){M.q.trackUndocumentedApiAccess("loyaltylion.ui.displayReferralDiscountAppliedModal"),s(this,vi,qi).call(this)}get site(){return M.q.trackUndocumentedApiAccess("loyaltylion.ui.site"),(0,g.Gd)((0,i.A)(this,di).getState())}get components(){return{buyWithPoints:{refresh:()=>{M.q.track({name:"undocumented_api_access",undocumented_api_path:"loyaltylion.ui.components.buyWithPoints.refresh"}),y.v.warn('"lion.ui.components.buyWithPoints.refresh()" is deprecated. Please use "lion.ui.refresh()"'),this.refresh()}}}}getElementsToPortal(){return M.q.trackUndocumentedApiAccess("loyaltylion.ui.getElementsToPortal"),s(this,bi,Wi).call(this)}async loadShopifyCartFunctionality(){M.q.trackUndocumentedApiAccess("loyaltylion.ui.loadShopifyCartFunctionality"),await s(this,Ai,Oi).call(this)}async fetchAndUpdateCart(){return M.q.trackUndocumentedApiAccess("loyaltylion.ui.fetchAndUpdateCart"),s(this,Si,Ui).call(this)}updateSessionCart(e){M.q.trackUndocumentedApiAccess("loyaltylion.ui.updateSessionCart"),s(this,Ri,Di).call(this,e)}async startShopifyCheckoutRedemption(){M.q.trackUndocumentedApiAccess("loyaltylion.ui.startShopifyCheckoutRedemption"),await s(this,ki,Ni).call(this)}observeCartStateForAddedItems(){M.q.trackUndocumentedApiAccess("loyaltylion.ui.observeCartStateForAddedItems"),s(this,Pi,Hi).call(this)}constructor(e){c(this,pi),c(this,hi),c(this,mi),c(this,gi),c(this,fi),c(this,yi),c(this,vi),(0,n.A)(this,wi,{get:Vi,set:void 0}),c(this,bi),c(this,Ai),c(this,Si),c(this,Ri),c(this,ki),c(this,Ci),c(this,Pi),c(this,Mi),(0,n.A)(this,di,{writable:!0,value:void 0}),(0,n.A)(this,ui,{writable:!0,value:void 0}),this.createdPortalElements=[],this.started=!1,this.rendered=!1,(0,o.A)(this,di,e),(0,o.A)(this,ui,(0,l.s)(250,(()=>{s(this,mi,Ei).call(this)})))}}function Ii(){if(!(0,ai.wt)((0,i.A)(this,di).getState()))return;const e=document.createElement("div");document.body.appendChild(e),this.createdPortalElements.push({definition:(0,ei.s)(Hr.find((e=>"loyaltyWidget"===e.name))),attribute:"",element:e})}function _i(){if(!(0,G.WW)((0,i.A)(this,di).getState()))return;this.container=document.createElement("div"),this.container.setAttribute("data-lion-react-container",""),document.body.appendChild(this.container);const e=s(this,bi,Wi).call(this);s(this,gi,Fi).call(this,e),this.rendered=!0,M.q.trackPageComponent(e,(0,i.A)(this,wi).id)}function Ei(){try{wr.unmountComponentAtNode(this.container)}catch(e){if(!(e instanceof DOMException&&e.message.includes("removeChild")))throw e;y.v.warn("DOM node not found while refreshing UI. This may be caused by manipulating DOM elements which are controlled by LoyaltyLion's application. This is not supported and can cause UI problems")}s(this,gi,Fi).call(this,s(this,bi,Wi).call(this)),this.priceForProductManager.scan(),this.augmentedElementsManager.scan()}function Fi(e){(0,i.A)(this,di).dispatch(ee.cf.setEmbedded(e.some((e=>"account"===e.attribute)))),wr.render(vr.createElement(br.Kq,{store:(0,i.A)(this,di)},vr.createElement(Ar.t,{renderIfError:null},vr.createElement(ci.qw,{portalElements:e}))),this.container)}function Ti(){const e=Nr((0,A.q0)("tab")??"");if(e)return void(0,i.A)(this,di).dispatch((0,ee.yd)(e));const t=(0,i.A)(this,wi).settings.loyaltyPanel.defaultPage;t&&(0,i.A)(this,di).dispatch((0,ee.yd)(t))}function Li(){const e=(0,A.q0)("ll_ref_id"),t=(0,G.df)((0,i.A)(this,di).getState()),r=(0,te.L4)((0,i.A)(this,di).getState());e&&(t&&!r?((0,i.A)(this,di).dispatch((0,Xt.hv)(e)),(0,i.A)(this,di).dispatch((0,Q.bM)("referral")),(0,i.A)(this,di).dispatch((0,Q.Q9)())):(0,i.A)(this,di).dispatch((0,er.de)(e)))}function qi(){const e=(0,A.q0)("discount_applied");(0,G.df)((0,i.A)(this,di).getState())&&e?((0,i.A)(this,di).dispatch((0,Q.bM)("referral-applied")),(0,i.A)(this,di).dispatch(Q.y.setPopoutOpen()),(0,A.Im)("discount_applied")):e&&((0,i.A)(this,di).dispatch((0,er.pA)()),(0,A.Im)("discount_applied"))}function Vi(){return(0,g.Gd)((0,i.A)(this,di).getState())}function Wi(){return[...this.createdPortalElements,...$r(Boolean((0,te.L4)((0,i.A)(this,di).getState())))]}async function Oi(){((0,Cr.xI)((0,i.A)(this,di).getState())?await s(this,Si,Ui).call(this):null)&&(s(this,Pi,Hi).call(this),await s(this,Ci,Bi).call(this))}async function Ui(){const e=await(0,Zr.t)();return e?((0,i.A)(this,di).dispatch((0,H.Bo)(e)),e):null}function Di(e){const t=z.lE.get("shopifyCart");if(e&&(0,C.oh)(e)){if(t&&(0,C.oh)(t)){_.F$.getAddedItemFromCarts(t,e)&&lr.F.track(lr.q.AddedItemToCart)}z.lE.set({shopifyCart:e})}else y.v.error("Attempted to update session cart with invalid cart",{fingerprintType:"message",newCart:e,oldCart:t})}async function Ni(){const e=(0,i.A)(this,di).getState();if(!(0,te.L4)(e))return;if(!(0,li.G)(e).checkout)return;if((0,K.VI)(e))try{const e=await new oi((0,i.A)(this,di)).start();this.createdPortalElements.push({definition:(0,ei.s)(Hr.find((e=>"checkoutSlider"===e.name))),element:e,attribute:""})}catch(t){if("Shopify checkout token not found"===t.message)return M.q.track({name:"checkout_redemption.checkout_token_not_found",client_revision:e.app.revision,site_id:(0,i.A)(this,wi).id});if("Discount section not found"===t.message)return M.q.track({name:"checkout_redemption.discount_section_not_found",client_revision:e.app.revision,site_id:(0,i.A)(this,wi).id});y.v.error("Shopify checkout redemption manager failed to start",{err:t,fingerprintType:"message"})}}async function Bi(){this.buyWithPointsManager=new Er((0,i.A)(this,di)),this.freeVariantManager=new Wr((0,i.A)(this,di));try{await this.buyWithPointsManager.start(),await this.freeVariantManager.start()}catch(e){y.v.error("Buy with Points component failed to start",{err:e,fingerprintType:"message"})}}function Hi(){I((0,i.A)(this,di),((e,t)=>{const r=(0,Cr.J1)(e),i=t&&(0,Cr.J1)(t);r&&r!==i&&s(this,Ri,Di).call(this,r)}))}function xi(){M.q.performance.mark("ui.start"),M.q.trackHistograms([{name:"loader_to_ui_start",value:M.q.performance.measure("loader.init","ui.start")}])}var $i=new WeakMap,zi=new WeakMap,ji=new WeakSet,Ji=new WeakMap,Qi=new WeakMap,Yi=new WeakSet,Ki=new WeakSet,Gi=new WeakSet,Xi=new WeakSet,Zi=new WeakSet;class Lion{get store(){return M.q.trackUndocumentedApiAccess("loyaltylion.store"),(0,i.A)(this,$i)}start(e){let{data:t,authPacket:r,customer:n,initData:o,translations:a}=e;p.$.env=t.config.env,p.$.sdkHost=t.config.sdkHost,p.$.platformHost=t.config.platformHost,p.$.loyaltylionFacebookAppId=t.config.loyaltylionFacebookAppId,p.$.appHost=t.config.appHost,this.analytics=new ft(z.HZ.get("visitorId"),p.$.sdkHost,this.revision);const c=t.site,{api:l}=t.config;l&&((0,i.A)(this,$i).dispatch(q(l.revision)),(0,i.A)(this,$i).dispatch(V(l.build??0))),(0,i.A)(this,$i).dispatch((0,De.an)(o)),(0,i.A)(this,$i).dispatch((0,x.Qn)(c));const u={...t.program,loyaltyTiers:t.program.loyaltyTiers.map((e=>({...e})))};(0,i.A)(this,$i).dispatch((0,N.E)(u));const h=(0,i.A)(this,$i).getState(),m=(0,lt.JV)(h),g={...a,...c.translationOverrides};yt.Ru.setTranslations(m,g),(0,i.A)(this,$i).dispatch((0,U.L)({[m]:g})),yt.Ru.setLocale((0,lt.JV)(h),(0,lt.I2)(h),(0,lt.zO)(h)),r&&(0,i.A)(this,$i).dispatch(W(r)),n&&(0,i.A)(this,$i).dispatch((0,O.hv)(n)),s(this,Xi,an).call(this),s(this,Zi,cn).call(this),this.api=new d.H(c.token,r,(0,i.A)(this,$i).dispatch),(0,f.I)({event:"ready"})}configure(e){const{checkout:t,disableBundledCSS:r,disableBundledFonts:n,useClassIsolator:o,useCamelCaseHooksResources:a,useThemeOverride:c,useUiOverride:l,shopifyFrontend:d,__EXPERIMENTAL__forcePreviewMode:u,__EXPERIMENTAL__enableFreeProductRewardsWithoutCart:p}=e;var h;"boolean"==typeof t&&(0,i.A)(this,$i).dispatch(Ve({checkout:t})),"boolean"==typeof r&&(0,i.A)(this,$i).dispatch(Ve({disableBundledCSS:r})),"boolean"==typeof n&&(0,i.A)(this,$i).dispatch(Ve({disableBundledFonts:n})),"boolean"==typeof o&&(0,i.A)(this,$i).dispatch(Ve({useClassIsolator:o})),"boolean"==typeof a&&(0,i.A)(this,$i).dispatch(Ve({useCamelCaseHooksResources:a})),"string"==typeof c&&(0,E.tc)(c)&&(0,i.A)(this,$i).dispatch(Ve({useThemeOverride:c})),"string"==typeof l&&(0,F.h)(l)&&(0,i.A)(this,$i).dispatch(Ve({useUiOverride:l})),"boolean"==typeof u&&((0,i.A)(this,$i).dispatch(Ve({__EXPERIMENTAL__forcePreviewMode:u})),s(this,Ki,on).call(this)),"boolean"==typeof p&&(0,i.A)(this,$i).dispatch(Ve({__EXPERIMENTAL__enableFreeProductRewardsWithoutCart:p})),"string"==typeof d&&(h=d,k.includes(h)?(0,i.A)(this,$i).dispatch((0,H.xd)(d)):y.v.warn(`Unexpected value passed for shopifyFrontend config. Must be one of: ${k.filter((e=>"unknown"!==e)).join(", ")}`)),e.save_customer_data_to_cookie&&y.v.warn("Saving data customer data to a cookie is no longer supported. If you need this feature, please contact us at support@loyaltylion.com"),e.show_loyalty_widget&&y.v.warn("The `show_loyalty_widget` configuration option is no longer supported. If you need this feature, please contact us at support@loyaltylion.com")}registerHook(e,t){vt.wC.registerHook(e,t)}get resources(){const{sdkJsApi:e}=(0,m.Nd)((0,i.A)(this,$i).getState());return e?(0,i.A)(this,zi):null}on(e,t,r){f.P.on(e,t,r)}removeListener(e,t){f.P.removeListener(e,t)}setCartState(e){(0,C.oh)(e)?(0,i.A)(this,$i).dispatch((0,H.Bo)(e)):y.v.error(`Site: ${(0,i.A)(this,Qi).id} Attempted to set invalid cart state`,{cart:e,consoleMessage:"setCartState requires a shopify cart object"})}identify_customer(e){this.legacyCustomerAuthenticator.setCustomerData(e).catch((e=>{y.v.error("Legacy `identify_customer` failed",{err:e})}))}auth_customer(e){this.legacyCustomerAuthenticator.setAuthData(e).catch((e=>{y.v.error("Legacy `auth_customer` failed",{err:e})}))}identify_product(){}track_pageview(){}async authenticateCustomer(e){if(!e||!e.customer||!e.auth)throw new Error("`customer` and `auth` properties are required for initialization");const t=(0,i.A)(this,$i).getState(),r=await(0,Ct.d)({authParams:e,sdkHost:p.$.sdkHost,token:(0,g.Jr)(t),revision:t.app.revision,referrer:z.HZ.get("referrer")||{},visitorId:z.HZ.get("visitorId")||""});r&&(s(this,ji,en).call(this,r),(0,i.A)(this,$i).dispatch((0,De.tC)({auth:e.auth,customer:e.customer})))}async logoutCustomer(){(0,te.L4)((0,i.A)(this,$i).getState())?((0,i.A)(this,$i).dispatch(B.a.removeCustomer()),this.ui?.refresh()):y.v.info("Customer not signed in")}updateCustomer(e){M.q.trackUndocumentedApiAccess("loyaltylion.updateCustomer"),this.dev.updateCustomer(e)}setCustomerAndAuthPacket(e){M.q.trackUndocumentedApiAccess("loyaltylion.setCustomerAndAuthPacket"),s(this,ji,en).call(this,e)}init(){throw new Error("Cannot call lion.init more than once. Please ensure there is only a single instance of the LoyaltyLion SDK snippet on the page")}_push(e){}get utils(){return M.q.trackUndocumentedApiAccess("loyaltylion.utils"),{uuid:T.u.v4}}get dev(){return M.q.trackUndocumentedApiAccess("loyaltylion.dev"),{addMessageNotification:()=>{const e=1e3*Math.random();(0,i.A)(this,$i).dispatch((0,D.p5)([{createdAt:(new Date).toISOString(),id:T.u.v4(),message:`${e.toFixed()} points for doing a thing`,value:e,kind:"point"}]))},addRedemptionNotification:()=>{(0,i.A)(this,$i).dispatch((0,D.p5)([{id:"reward_redemption",kind:"reward_redemption",createdAt:(new Date).toISOString()}]))},addReferralPromptNotification:()=>{(0,i.A)(this,$i).dispatch((0,D.p5)([{createdAt:(new Date).toISOString(),id:"post_purchase_referral",kind:"post_purchase_referral"}]))},changeLocale:e=>{(0,i.A)(this,$i).dispatch((0,x.pL)(e))},reloadThemeCss:()=>{},selectNotificationsToDisplay:()=>(0,dt.aC)((0,i.A)(this,$i).getState()),updateCustomer:e=>{(0,i.A)(this,$i).dispatch((0,O.Gk)(e))}}}get customer(){return M.q.trackUndocumentedApiAccess("loyaltylion.customer"),(0,i.A)(this,Ji)}get site(){return M.q.trackUndocumentedApiAccess("loyaltylion.site"),(0,i.A)(this,Qi)}get program(){return M.q.trackUndocumentedApiAccess("loyaltylion.program"),(0,m.L2)((0,i.A)(this,$i).getState())}displayPendingNotifications(e){M.q.trackUndocumentedApiAccess("loyaltylion.displayPendingNotifications"),e&&(0,i.A)(this,$i).dispatch((0,D.p5)(e.pendingNotifications))}analyticsObserver(e,t){M.q.trackUndocumentedApiAccess("loyaltylion.analyticsObserver"),s(this,Yi,nn).call(this,e,t)}localCurrencyListener(){M.q.trackUndocumentedApiAccess("loyaltylion.localCurrencyListener"),s(this,Xi,an).call(this)}startWindowSizeListener(){M.q.trackUndocumentedApiAccess("loyaltylion.startWindowSizeListener"),s(this,Zi,cn).call(this)}constructor(e,t,r,a,l){c(this,ji),(0,n.A)(this,Ji,{get:tn,set:void 0}),(0,n.A)(this,Qi,{get:rn,set:void 0}),c(this,Yi),c(this,Ki),c(this,Gi),c(this,Xi),c(this,Zi),(0,n.A)(this,$i,{writable:!0,value:void 0}),(0,n.A)(this,zi,{writable:!0,value:void 0}),this.token=t,this.revision=r,this.themeManifest=a,this.fontManifest=l,this.version=$.MF,this.isLoyaltyLion=!0,(0,o.A)(this,$i,e),(0,o.A)(this,zi,new kt(e)),s(this,Gi,sn).call(this),function(e){const t=(0,A.q0)("ll_eid")||z.lE.get("emailTrackingId"),r=(0,A.q0)("ll_rid"),i={emailAction:(0,X.JN)((0,A.q0)("ll_act")),emailClaimRewardId:r?parseInt(r,10):null,emailTrackingId:t};e.dispatch(re(i)),z.lE.set({emailTrackingId:t})}((0,i.A)(this,$i)),(0,i.A)(this,$i).dispatch(nt(r)),(0,i.A)(this,$i).dispatch(ot(a)),(0,i.A)(this,$i).dispatch(st(l)),this.legacyCustomerAuthenticator=new P.J((async e=>this.authenticateCustomer(e))),f.P.on("ready",(()=>{y.v.info("Ready"),s(this,Ki,on).call(this),(0,i.A)(this,Ji)&&(0,i.A)(this,$i).dispatch((0,D.p5)((0,i.A)(this,Ji).pendingNotifications)),I((0,i.A)(this,$i),((e,t)=>{yt.Ru.setLocale((0,lt.JV)(e),(0,lt.I2)(e),(0,lt.zO)(e));const r=ct(e);r!==(t&&ct(t))&&(this.api=new d.H(this.token,r,(0,i.A)(this,$i).dispatch)),s(this,Yi,nn).call(this,e,t)})),this.ui=new UI((0,i.A)(this,$i)),this.integrations=new de((0,i.A)(this,$i)),this.ui.start().catch((e=>{y.v.error(`Error when starting UI: ${e.message}`,{err:e,fingerprintType:"message"})}))}))}}function en(e){(0,i.A)(this,$i).dispatch((0,D.SP)()),(0,i.A)(this,$i).dispatch((0,u.U)()),e.customer&&((0,i.A)(this,$i).dispatch((0,O.hv)(e.customer)),(0,i.A)(this,$i).dispatch((0,D.p5)(e.customer.pendingNotifications))),e.authPacket&&(0,i.A)(this,$i).dispatch(W(e.authPacket)),(0,i.A)(this,$i).dispatch((0,D.li)()),this.ui?.refresh()}function tn(){return(0,te.L4)((0,i.A)(this,$i).getState())}function rn(){return(0,g.Gd)((0,i.A)(this,$i).getState())}function nn(e,t){t&&(e.isLoyaltySplashOrPanelModalOpen&&!t.isLoyaltySplashOrPanelModalOpen||e.loyaltyPanel.isEmbedded&&!t.loyaltyPanel.isEmbedded)&&this.analytics.trackEvent("panel","open")}function on(){const e=(0,R.B)((0,i.A)(this,$i));e&&(0,i.A)(this,$i).dispatch((e=>{let{context:t,lion:i}=e;return async(e,n)=>{const{status:o}=(0,w.Z2)(n());if("enabled"===o||"loading"===o)return;const s=S();if(s&&e(v.K0.setAuth(s)),(0,m.V4)(n())){e((0,v.eb)(t)),e((0,v.nj)("loading"));try{const{createControlModeHelpers:o,MockHttpClient:s,controlModeMiddleware:a}=await Promise.all([r.e(99),r.e(207),r.e(473)]).then(r.bind(r,3553)).then((t=>{let{startControlMode:r}=t;return r(e,n)}));if((0,h.I7)(a),i){const t=o(e,n);i.control=t,i.edit=t}d.H.buildFromState=(e,t)=>{const r=(0,g.Gd)(e);return new d.H(r.token,e.authPacket,t,new s(e))},i&&(i.api=d.H.buildFromState(n(),e),Object.defineProperty(i,"resources",{get(){throw new Error("lion.resources is disabled when previewing")}})),(0,f.I)({event:"controlMode:enabled",context:t})}catch(t){y.v.error("control mode failed to start",{err:t}),e((0,v.nj)("failed"))}y.v.debug(`Control mode started in '${t}' context`),e((0,v.nj)("enabled"))}}})({context:e,lion:this}))}function sn(){0}function an(){(0,G.NB)((0,i.A)(this,$i).getState()).currencyConversionEnabled&&setInterval((()=>{if(!window.Currency&&!window.Shopify?.currency)return;const e=(0,_.Eg)();e&&(0,i.A)(this,$i).dispatch((0,H._J)(e)).catch((e=>{y.v.warn("Failed to request local currency",{err:e})}))}),1e3)}function cn(){const e=()=>{(0,i.A)(this,$i).dispatch((0,qe.A)({window:{height:window.innerHeight,width:window.innerWidth}}))};e(),window.addEventListener("resize",(0,l.s)(250,e))}const ln=(e,t,r,i)=>{try{const n=function(){const e=(0,ue.legacy_createStore)(cr,Ze,(0,Pt.tY)((0,ue.applyMiddleware)(...yr),ur));return lr.F.initialize(e),e}();return vt.wC.initialize(n),M.q.store=n,new Lion(n,e,t,r,i)}catch(r){return y.v.error("Failed to create Lion instance",{err:r,token:e,revision:t}),null}}},8097:(e,t,r)=>{function i(e,t,r){var i=(r||{}).atBegin;return function(e,t,r){var i,n=r||{},o=n.noTrailing,s=void 0!==o&&o,a=n.noLeading,c=void 0!==a&&a,l=n.debounceMode,d=void 0===l?void 0:l,u=!1,p=0;function h(){i&&clearTimeout(i)}function m(){for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];var a=this,l=Date.now()-p;function m(){p=Date.now(),t.apply(a,n)}function g(){i=void 0}u||(c||!d||i||m(),h(),void 0===d&&l>e?c?(p=Date.now(),s||(i=setTimeout(d?g:m,e))):m():!0!==s&&(i=setTimeout(d?g:m,void 0===d?e-l:e)))}return m.cancel=function(e){var t=(e||{}).upcomingOnly,r=void 0!==t&&t;h(),u=!r},m}(e,t,{debounceMode:!1!==(void 0!==i&&i)})}r.d(t,{s:()=>i})}}]);