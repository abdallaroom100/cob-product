/*!
 * Copyright by Space Squirrel Ltd.
 */
import{r as t,c as e,h as i,H as s,g as o}from"./p-185b4f2e.js";import{B as r,s as n,f as a}from"./p-1436f40f.js";import{c as h,a as l,p as u,b as d}from"./p-cc3f09f6.js";import{s as c,m as f}from"./p-b1aaf8a0.js";import{s as _}from"./p-88c71dba.js";import{g as p,s as v}from"./p-a8728ca2.js";import{g as m}from"./p-0243f586.js";const b="/api/v1/embed/:id";const g="/api/v1/shop/:shop/product/:handle";class w{constructor(t,e){this.page=0;this.isLoading=false;this.totalPages=1;this.previewSettings={};this.previewHoverMode=false;this.previewPopupMode=false;this.previewMode=false;this.sortType="";this._customSettings={};this._selectedFilters=[];this._environment="production";if(typeof e==="boolean"){this.previewMode=e}if(typeof t==="string"&&Object.keys(r).includes(t)){this._environment=t}}get baseUrl(){return r[this._environment]}get galleryType(){return this.productHandle?"product_gallery":"standard_gallery"}setCustomSettings(t){this._customSettings=Object.assign({},t);Object.keys(this._customSettings).forEach((t=>this._customSettings[t]===null?delete this._customSettings[t]:this._customSettings[t]));return this._customSettings}setSelectedFilters(t){return this._selectedFilters=[...t]}standardGalleryUrl(){return b.replace(":id",this.embedId)}productGalleryUrl(){return g.replace(":shop",this.shopDomain).replace(":handle",this.productHandle)}galleryUrl(){if(this._environment==="testing")return"http://localhost:3000/embed";let t=this.baseUrl;this.productHandle?t+=this.productGalleryUrl():t+=this.standardGalleryUrl();if(this.previewMode)t+="/preview";if(this.sortType!=="")t+=`?sort_by=${this.sortType}`;return t}resetPagination(){this.page=0;this.totalPages=1}async fetchItems(){if(this.isLoading||this.page>=this.totalPages){return}this.isLoading=true;this.page+=1;let t=this.galleryUrl();const e=[];if(this.page>1){e.push(`page=${this.page}`)}if(this._selectedFilters.length>0){if(this.previewMode){this.previewSettings["filters"]=this._selectedFilters}else{this._selectedFilters.forEach((t=>e.push(encodeURIComponent("filters[]")+"="+encodeURIComponent(t))))}}if(e.length>0){t+=`?${e.join("&")}`}const i=await fetch(t,this.fetchOptions);if(!i.ok){throw new Error(`${i.status}`)}const s=await i.json();s.items=this.getItemsWithLocaleLinks(s.items);this.data=Object.assign({},s);this.data.settings=Object.assign(Object.assign({},this.data.settings),this._customSettings);s.settings=Object.assign(Object.assign({},s.settings),this._customSettings);this.totalPages=s.total_pages;this.galleryId=s.gallery_id;this.shopId=s.shop_id;this.isLoading=false;return s}getItemsWithLocaleLinks(t){const e=t=>{const e=window.location.hostname;let i=t;const s=window.Shopify;if(typeof s!=="undefined"&&s.routes&&s.routes.root&&s.routes.root!=="/"){return i.replace(`${e}/`,`${e}${s.routes.root}`)}return i};t.forEach((t=>{if(t.links&&t.links.length>0){t.links.forEach((t=>{t.link=e(t.link);return t}))}return t}));return t}get fetchOptions(){const t={};const e={};const i=Object.keys(this.previewSettings);if(this.previewMode){e["method"]="POST";e["headers"]={"Content-Type":"application/json"};if(i.length>0){i.forEach((e=>{const i=e.replace(/^(gallery_embed\[)/,"").replace(/\]$/,"");t[i]=this.previewSettings[e]}));e["body"]=JSON.stringify(t)}}return e}}var y=[];var S=function(){return y.some((function(t){return t.activeTargets.length>0}))};var O=function(){return y.some((function(t){return t.skippedTargets.length>0}))};var x="ResizeObserver loop completed with undelivered notifications.";var E=function(){var t;if(typeof ErrorEvent==="function"){t=new ErrorEvent("error",{message:x})}else{t=document.createEvent("Event");t.initEvent("error",false,false);t.message=x}window.dispatchEvent(t)};var I;(function(t){t["BORDER_BOX"]="border-box";t["CONTENT_BOX"]="content-box";t["DEVICE_PIXEL_CONTENT_BOX"]="device-pixel-content-box"})(I||(I={}));var k=function(t){return Object.freeze(t)};var z=function(){function t(t,e){this.inlineSize=t;this.blockSize=e;k(this)}return t}();var F=function(){function t(t,e,i,s){this.x=t;this.y=e;this.width=i;this.height=s;this.top=this.y;this.left=this.x;this.bottom=this.top+this.height;this.right=this.left+this.width;return k(this)}t.prototype.toJSON=function(){var t=this,e=t.x,i=t.y,s=t.top,o=t.right,r=t.bottom,n=t.left,a=t.width,h=t.height;return{x:e,y:i,top:s,right:o,bottom:r,left:n,width:a,height:h}};t.fromRect=function(e){return new t(e.x,e.y,e.width,e.height)};return t}();var P=function(t){return t instanceof SVGElement&&"getBBox"in t};var U=function(t){if(P(t)){var e=t.getBBox(),i=e.width,s=e.height;return!i&&!s}var o=t,r=o.offsetWidth,n=o.offsetHeight;return!(r||n||t.getClientRects().length)};var C=function(t){var e;if(t instanceof Element){return true}var i=(e=t===null||t===void 0?void 0:t.ownerDocument)===null||e===void 0?void 0:e.defaultView;return!!(i&&t instanceof i.Element)};var j=function(t){switch(t.tagName){case"INPUT":if(t.type!=="image"){break}case"VIDEO":case"AUDIO":case"EMBED":case"OBJECT":case"CANVAS":case"IFRAME":case"IMG":return true}return false};var M=typeof window!=="undefined"?window:{};var R=new WeakMap;var D=/auto|scroll/;var T=/^tb|vertical/;var H=/msie|trident/i.test(M.navigator&&M.navigator.userAgent);var B=function(t){return parseFloat(t||"0")};var W=function(t,e,i){if(t===void 0){t=0}if(e===void 0){e=0}if(i===void 0){i=false}return new z((i?e:t)||0,(i?t:e)||0)};var A=k({devicePixelContentBoxSize:W(),borderBoxSize:W(),contentBoxSize:W(),contentRect:new F(0,0,0,0)});var $=function(t,e){if(e===void 0){e=false}if(R.has(t)&&!e){return R.get(t)}if(U(t)){R.set(t,A);return A}var i=getComputedStyle(t);var s=P(t)&&t.ownerSVGElement&&t.getBBox();var o=!H&&i.boxSizing==="border-box";var r=T.test(i.writingMode||"");var n=!s&&D.test(i.overflowY||"");var a=!s&&D.test(i.overflowX||"");var h=s?0:B(i.paddingTop);var l=s?0:B(i.paddingRight);var u=s?0:B(i.paddingBottom);var d=s?0:B(i.paddingLeft);var c=s?0:B(i.borderTopWidth);var f=s?0:B(i.borderRightWidth);var _=s?0:B(i.borderBottomWidth);var p=s?0:B(i.borderLeftWidth);var v=d+l;var m=h+u;var b=p+f;var g=c+_;var w=!a?0:t.offsetHeight-g-t.clientHeight;var y=!n?0:t.offsetWidth-b-t.clientWidth;var S=o?v+b:0;var O=o?m+g:0;var x=s?s.width:B(i.width)-S-y;var E=s?s.height:B(i.height)-O-w;var I=x+v+y+b;var z=E+m+w+g;var C=k({devicePixelContentBoxSize:W(Math.round(x*devicePixelRatio),Math.round(E*devicePixelRatio),r),borderBoxSize:W(I,z,r),contentBoxSize:W(x,E,r),contentRect:new F(d,h,x,E)});R.set(t,C);return C};var G=function(t,e,i){var s=$(t,i),o=s.borderBoxSize,r=s.contentBoxSize,n=s.devicePixelContentBoxSize;switch(e){case I.DEVICE_PIXEL_CONTENT_BOX:return n;case I.BORDER_BOX:return o;default:return r}};var L=function(){function t(t){var e=$(t);this.target=t;this.contentRect=e.contentRect;this.borderBoxSize=k([e.borderBoxSize]);this.contentBoxSize=k([e.contentBoxSize]);this.devicePixelContentBoxSize=k([e.devicePixelContentBoxSize])}return t}();var q=function(t){if(U(t)){return Infinity}var e=0;var i=t.parentNode;while(i){e+=1;i=i.parentNode}return e};var N=function(){var t=Infinity;var e=[];y.forEach((function i(s){if(s.activeTargets.length===0){return}var o=[];s.activeTargets.forEach((function e(i){var s=new L(i.target);var r=q(i.target);o.push(s);i.lastReportedSize=G(i.target,i.observedBox);if(r<t){t=r}}));e.push((function t(){s.callback.call(s.observer,o,s.observer)}));s.activeTargets.splice(0,s.activeTargets.length)}));for(var i=0,s=e;i<s.length;i++){var o=s[i];o()}return t};var V=function(t){y.forEach((function e(i){i.activeTargets.splice(0,i.activeTargets.length);i.skippedTargets.splice(0,i.skippedTargets.length);i.observationTargets.forEach((function e(s){if(s.isActive()){if(q(s.target)>t){i.activeTargets.push(s)}else{i.skippedTargets.push(s)}}}))}))};var J=function(){var t=0;V(t);while(S()){t=N();V(t)}if(O()){E()}return t>0};var K;var Y=[];var Z=function(){return Y.splice(0).forEach((function(t){return t()}))};var Q=function(t){if(!K){var e=0;var i=document.createTextNode("");var s={characterData:true};new MutationObserver((function(){return Z()})).observe(i,s);K=function(){i.textContent="".concat(e?e--:e++)}}Y.push(t);K()};var X=function(t){Q((function e(){requestAnimationFrame(t)}))};var tt=0;var et=function(){return!!tt};var it=250;var st={attributes:true,characterData:true,childList:true,subtree:true};var ot=["resize","load","transitionend","animationend","animationstart","animationiteration","keyup","keydown","mouseup","mousedown","mouseover","mouseout","blur","focus"];var rt=function(t){if(t===void 0){t=0}return Date.now()+t};var nt=false;var at=function(){function t(){var t=this;this.stopped=true;this.listener=function(){return t.schedule()}}t.prototype.run=function(t){var e=this;if(t===void 0){t=it}if(nt){return}nt=true;var i=rt(t);X((function(){var s=false;try{s=J()}finally{nt=false;t=i-rt();if(!et()){return}if(s){e.run(1e3)}else if(t>0){e.run(t)}else{e.start()}}}))};t.prototype.schedule=function(){this.stop();this.run()};t.prototype.observe=function(){var t=this;var e=function(){return t.observer&&t.observer.observe(document.body,st)};document.body?e():M.addEventListener("DOMContentLoaded",e)};t.prototype.start=function(){var t=this;if(this.stopped){this.stopped=false;this.observer=new MutationObserver(this.listener);this.observe();ot.forEach((function(e){return M.addEventListener(e,t.listener,true)}))}};t.prototype.stop=function(){var t=this;if(!this.stopped){this.observer&&this.observer.disconnect();ot.forEach((function(e){return M.removeEventListener(e,t.listener,true)}));this.stopped=true}};return t}();var ht=new at;var lt=function(t){!tt&&t>0&&ht.start();tt+=t;!tt&&ht.stop()};var ut=function(t){return!P(t)&&!j(t)&&getComputedStyle(t).display==="inline"};var dt=function(){function t(t,e){this.target=t;this.observedBox=e||I.CONTENT_BOX;this.lastReportedSize={inlineSize:0,blockSize:0}}t.prototype.isActive=function(){var t=G(this.target,this.observedBox,true);if(ut(this.target)){this.lastReportedSize=t}if(this.lastReportedSize.inlineSize!==t.inlineSize||this.lastReportedSize.blockSize!==t.blockSize){return true}return false};return t}();var ct=function(){function t(t,e){this.activeTargets=[];this.skippedTargets=[];this.observationTargets=[];this.observer=t;this.callback=e}return t}();var ft=new WeakMap;var _t=function(t,e){for(var i=0;i<t.length;i+=1){if(t[i].target===e){return i}}return-1};var pt=function(){function t(){}t.connect=function(t,e){var i=new ct(t,e);ft.set(t,i)};t.observe=function(t,e,i){var s=ft.get(t);var o=s.observationTargets.length===0;if(_t(s.observationTargets,e)<0){o&&y.push(s);s.observationTargets.push(new dt(e,i&&i.box));lt(1);ht.schedule()}};t.unobserve=function(t,e){var i=ft.get(t);var s=_t(i.observationTargets,e);var o=i.observationTargets.length===1;if(s>=0){o&&y.splice(y.indexOf(i),1);i.observationTargets.splice(s,1);lt(-1)}};t.disconnect=function(t){var e=this;var i=ft.get(t);i.observationTargets.slice().forEach((function(i){return e.unobserve(t,i.target)}));i.activeTargets.splice(0,i.activeTargets.length)};return t}();var vt=function(){function t(t){if(arguments.length===0){throw new TypeError("Failed to construct 'ResizeObserver': 1 argument required, but only 0 present.")}if(typeof t!=="function"){throw new TypeError("Failed to construct 'ResizeObserver': The callback provided as parameter 1 is not a function.")}pt.connect(this,t)}t.prototype.observe=function(t,e){if(arguments.length===0){throw new TypeError("Failed to execute 'observe' on 'ResizeObserver': 1 argument required, but only 0 present.")}if(!C(t)){throw new TypeError("Failed to execute 'observe' on 'ResizeObserver': parameter 1 is not of type 'Element")}pt.observe(this,t,e)};t.prototype.unobserve=function(t){if(arguments.length===0){throw new TypeError("Failed to execute 'unobserve' on 'ResizeObserver': 1 argument required, but only 0 present.")}if(!C(t)){throw new TypeError("Failed to execute 'unobserve' on 'ResizeObserver': parameter 1 is not of type 'Element")}pt.unobserve(this,t)};t.prototype.disconnect=function(){pt.disconnect(this)};t.toString=function(){return"function ResizeObserver () { [polyfill code] }"};return t}();const mt=h({name:"widgetId",initialState:{embedId:null,productHandle:null,shopDomain:null,galleryId:null,shopId:null,photoRequestId:null},reducers:{widgetIdUpdated:(t,e)=>{const{embedId:i,productHandle:s,shopDomain:o,photoRequestId:r}=e.payload;t.embedId=i;t.productHandle=s;t.shopDomain=o;t.photoRequestId=r},widgetGalleryIdUpdated:(t,e)=>{t.galleryId=e.payload},widgetShopIdUpdated:(t,e)=>{t.shopId=e.payload}}});const{widgetIdUpdated:bt,widgetGalleryIdUpdated:gt,widgetShopIdUpdated:wt}=mt.actions;const yt=mt.reducer;const St={production:"https://app.covet.pics",development:"http://localhost:3000",staging:"https://covetstaging.spacesquirrel.net",testing:"http://localhost:3000/testing_db"};const Ot="/api/v1/beacons";const xt=h({name:"url",initialState:{baseUrl:"",environment:"",baseBeaconsUrl:""},reducers:{setEnvironment:(t,e)=>{const i=e.payload;typeof i==="string"&&Object.keys(St).includes(i)?t.environment=i:t.environment="production";t.baseUrl=St[t.environment];t.baseBeaconsUrl=`${St[t.environment]}${Ot}/`;return t}}});const{setEnvironment:Et}=xt.actions;const It=xt.reducer;const kt=h({name:"size",initialState:{widgetWidth:320,windowHeight:600,isDesktopScreen:true},reducers:{widgetWidthUpdated:(t,e)=>{t.widgetWidth=e.payload;t.isDesktopScreen=e.payload>=800},windowHeightUpdated:(t,e)=>{t.windowHeight=e.payload}}});const{widgetWidthUpdated:zt,windowHeightUpdated:Ft}=kt.actions;const Pt=kt.reducer;const Ut=h({name:"preview",initialState:{hoverMode:false,popupMode:false,mode:false},reducers:{setPreviewHoverMode:(t,e)=>{t.hoverMode=e.payload},setPreviewPopupMode:(t,e)=>{t.popupMode=e.payload},setPreviewMode:(t,e)=>{t.mode=e.payload}}});const{setPreviewHoverMode:Ct,setPreviewPopupMode:jt,setPreviewMode:Mt}=Ut.actions;const Rt=Ut.reducer;const Dt=h({name:"analytics",initialState:false,reducers:{setAnalytics:(t,e)=>{t=e.payload;return t}}});const{setAnalytics:Tt}=Dt.actions;const Ht=Dt.reducer;const Bt={add_to_cart_button_caption:"Add to cart",arrow_color_theme:"light",arrow_custom_box_color:"#000000",arrow_custom_color:"#d3d3d3",arrow_graphics_type:"type_1",arrow_size:"standard",arrow_size_custom:48,background_color:"#000000",close_button_color_theme:"dark_btn",close_button_custom_box_color:"#000000",close_button_custom_color:"#d3d3d3",close_button_position:"side",close_button_size:"standard",close_button_type:"btn_type_1",customer_photo_item_label:"Add Your Photo",customer_photo_item_position:null,customer_photo_upload_body:"We would love to see it in action",customer_photo_upload_button_selector:"",customer_photo_upload_complete_body:"Thank you for your awesome photo! You will see it on the site once it’s approved",customer_photo_upload_complete_close_label:"Close",customer_photo_upload_drop_files_label:"Drag & Drop photos here",customer_photo_upload_form_body_placeholder:"Say something about your image",customer_photo_upload_form_email_placeholder:"E-mail",customer_photo_upload_form_legal_message:"",customer_photo_upload_form_name_placeholder:"Nickname",customer_photo_upload_form_send_label:"Send",customer_photo_upload_form_uploading:"Uploading...",customer_photo_upload_title:"Show It off",customer_widget_cover:null,desktop_arrow_position:"middle",direct_add_to_cart:true,display_type:"grid",font_family:"Source Sans Pro",gallery_highlight:false,gallery_highlight_every:0,gallery_highlight_every_start:0,gallery_mobile_photos_per_row:2,gallery_photos_count:0,gallery_photos_per_row:4,header_show_average_rating:true,header_show_breakdown:true,header_show_sort:true,header_type:"header-1",hide_branding:false,hide_social_links:false,highlight_hotspots_layout:"hotspot-tall",highlight_layout:"slider",highlight_products_layout:"layout-1",hotspots:{enabled:false,background_color:"#000000",show_numbers:false,text_color:"#ffffff"},item_reveal_content:"",item_animation_duration:1,item_animation_type:"hover-animation-1",item_hover_background_opacity:80,item_hover_border_color:"#C1ACAC",item_hover_color_from:"#000000",item_hover_color_to:"#000000",item_hover_disabled:false,item_hover_icon:false,item_label_color:"#FFFFFF",item_label_font_size:15,item_label_font_style:"Normal",item_label_text:"SHOP THIS LOOK",item_mobile_padding:0,item_open_link:false,item_padding:1,item_style:"standard",item_without_product_label_text:"SEE MORE",load_more_border_width:4,load_more_button_color:"#000000",load_more_button_style:"btn_style_1",load_more_font_size:14,load_more_font_style:"bold",load_more_padding:6,load_more_text:"MORE",mobile_arrow_color_theme:"mob_light",mobile_arrow_custom_box_color:"#000000",mobile_arrow_custom_color:"#d3d3d3",mobile_arrow_graphics_type:"mob_type_1",mobile_arrow_position:"mob_top",money_format:"{{amount}}",multiple_filter_enabled:false,padding:0,pagination:"button",popup_animation:true,popup_background_color:"#000000",popup_background_opacity:80,popup_buy_button_background_color:"#444444",popup_buy_button_background_hover_color:"#000000",popup_buy_button_text_color:"#FFFFFF",popup_buy_button_text_hover_color:"#000000",popup_custom_link_label:"Visit",popup_disable_modal:false,popup_image_size:"responsive",popup_products_button_caption:"Buy Now",popup_products_title:"SHOP THIS LOOK",popup_products_title_disabled:false,popup_buy_button_style:"buy_btn_style_1",popup_products_view_type:"grid_view",price_label_caption:"Price",primary_color:"#222222",secondary_color:"#BFBFBF",select_label_caption:"Select",show_header:false,show_price:true,show_price_in_popup:true,show_review:true,slideshow_autoplay:0,slideshow_load_more:true,slideshow_video_auto_play:false,slideshow_mobile_photos_per_row:2,slideshow_photos_per_row:4,slideshow_crop_mode:false,slideshow_style:"regular",slideshow_desktop_pagination_style:"none",slideshow_mobile_pagination_style:"dots",star_color:"#FCD02C",tags_color:"",tags_font_size:12,tags_font_weight:"",tags_padding:0,tags_reset_button_text:""};const Wt=t=>{t._arrowsDesktopType=`arrows-${t.arrow_graphics_type.toString().replace("_","-")}`;t._arrowsDesktopSizeType=t.arrow_size.toString().replace("_arrow","");t._arrowsDesktopPosition=t.desktop_arrow_position.toString().replace("sidebar_","");t._arrowsMobileColorTheme=t.mobile_arrow_color_theme.toString().replace("mob_","");t._arrowsMobilePosition=t.mobile_arrow_position.toString().replace("mob_","");t._arrowsMobileType=t.mobile_arrow_graphics_type.toString().replace("mob_","arrows-").replace("_","-");t._buyButtonStyle=t.popup_buy_button_style.replace("buy_btn_","").replace("_","-");t._closeButtonType=t.close_button_type.toString().split("_").join("-");t._closeButtonСolorTheme=`close-button-color-theme-${t.close_button_color_theme.toString().replace("_btn","")}`;return t};const At=h({name:"settings",initialState:Wt(Bt),reducers:{setSettings:(t,e)=>{t=Wt(e.payload);return t}}});const{setSettings:$t}=At.actions;const Gt=At.reducer;const Lt=l({analytics:Ht,size:Pt,sort:c,url:It,preview:Rt,popup:u,modals:f,slider:_,widgetId:yt,settings:Gt});function qt(){const t=d({reducer:Lt});return t}const Nt=":host{--covet-font-family:var(--covet-custom-font-family, var(--covet-internal-font-family)), sans-serif}:host{font-family:var(--covet-font-family);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;display:block}:host .error-message{text-align:center;border:2px dashed;padding:20px}";const Vt=Nt;const Jt=class{constructor(i){t(this,i);this.updateUploadWidgetCover=e(this,"updateUploadWidgetCover",7);this.elementResize=e(this,"elementResize",7);this.fontsLoaded=false;this.filters={};this.shop=undefined;this.galleryEmbedId=undefined;this.shopifyProductId=undefined;this.environment=undefined;this.customSettings=undefined;this.hideElements=undefined;this.previewMode=false;this.photoRequestId=undefined;this.isLoading=true;this.minNumberOfPhotos=undefined;this.items=[];this.appStore=undefined;this.fetchingError=null}async sortUpdatedHandler(t){this.loader.resetPagination();this.loader.sortType=t.detail;const e=await this.loader.fetchItems();if(typeof e!=="undefined"){this.items=[];this.items=[...this.getItemsWithUpload(e.items)]}}async filtersUpdatedHandler(t){const e=t.detail.resetFilters;if(this.appState.preview.mode){delete this.loader.previewSettings["filters"]}const i=()=>{Object.keys(this.filters).forEach((t=>this.filters[t]=false));this.loader.setSelectedFilters([])};if(e){i()}else{const e=t.detail.filter;if(!this.appState.settings.multiple_filter_enabled&&!this.filters[e]){i()}this.filters[e]=!this.filters[e]}const s=Object.keys(this.filters).filter((t=>this.filters[t]));this.loader.setSelectedFilters(s);this.loader.resetPagination();const o=await this.loader.fetchItems();if(typeof o!=="undefined"){this.items=[];this.items=[...this.getItemsWithUpload(o.items)]}}async nextPageHandler(){const t=await this.loader.fetchItems();if(typeof t!=="undefined"){this.items=[...this.items,...t.items]}}async updateUploadWidgetCoverPreview(t){this.updateUploadWidgetCover.emit({image:t})}async updatePreviewSettings(t,e,i){this.loader.previewHoverMode=e;this.loader.previewPopupMode=i;this.appStore.dispatch(Ct(e));this.appStore.dispatch(jt(i));this.fontsLoaded=false;this.loader.previewSettings=Object.assign(Object.assign({},this.loader.previewSettings),t);this.loader.resetPagination();this.loadData()}componentWillLoad(){this.initAppStore();this.setupLoader();this.loadData()}componentDidLoad(){this.resizeObserver=new vt((()=>{const t=this.appState.size.windowHeight!==window.innerHeight;if(t){this.appStore.dispatch(Ft(window.innerHeight))}const e=this.appState.size.widgetWidth!==this.el.getBoundingClientRect().width;if(this.isWidgetWrapExist()&&e){this.setWidgetWidth();this.elementResize.emit()}}));if(this.isWidgetWrapExist()){this.resizeObserver.observe(this.el.parentElement)}}disconnectedCallback(){this.unsubscribe();this.resizeObserver.disconnect()}initAppStore(){this.appStore=qt();const t=p(this.galleryEmbedId,this.shop,this.photoRequestId,this.el);this.appStore.dispatch(bt(t));this.appStore.dispatch(Et(this.environment));this.appStore.dispatch(Mt(this.previewMode));this.appState=this.appStore.getState();this.unsubscribe=this.appStore.subscribe((()=>{this.appState=this.appStore.getState()}));this.setWidgetWidth()}setupLoader(){const t=window.location;this.loader=new w(this.environment,this.previewMode);if(typeof this.customSettings==="string"){this.loader.setCustomSettings(JSON.parse(this.customSettings))}if(typeof this.galleryEmbedId==="undefined"||this.galleryEmbedId===0){if(this.shopifyProductId!==undefined){this.loader.productHandle=`shopify/${this.shopifyProductId}`}else if(this.el.getAttribute("data-product")!==null){this.loader.productHandle=this.el.getAttribute("data-product")}else if(t.pathname.indexOf("/products/")!==-1){this.loader.productHandle=t.pathname.match(/\/products\/([a-zA-Z0-9\-\_\%]+)/)[1]}if(this.el.hasAttribute("data-shop")){this.shop=this.el.getAttribute("data-shop")}if(typeof this.shop==="undefined"){this.fetchingError="The Covet.pics gallery embed has not loaded due to a missing Embed ID. Please make sure to fill in the correct Embed ID";this.isLoading=false;return}else{this.loader.shopDomain=this.shop}}else{this.loader.embedId=this.galleryEmbedId}}async loadData(){if(this.fetchingError!==null)return;this.isLoading=true;try{const t=await this.loader.fetchItems();this.appStore.dispatch(gt(this.loader.galleryId));this.appStore.dispatch(wt(this.loader.shopId));if(this.loader.data.analytics){this.appStore.dispatch(Tt(this.loader.data.analytics))}else{this.appStore.dispatch(Tt(false))}if(typeof t==="undefined")return false;this.appStore.dispatch($t(t.settings));this.minNumberOfPhotos=t.settings.min_number_of_photos;this.loader.data.settings.display_type==="highlight"?this.items=[...t.items]:this.items=[...this.getItemsWithUpload(t.items)];this.hideElementsIfEmpty();if(!this.fontsLoaded){this.loadFont()}if(this.hasEnoughPhotos&&m(this.appState)){const t="Covet.pics Gallery";const e="Covet.pics Gallery View";const i="Covet.pics Gallery View - "+this.galleryEmbedId;n(e,t,i)}if(this.hasEnoughPhotos){v(this.appState,"gallery_view")}this.sharedItemId=await this.findAndLoadSharedItemId();this.initFilters();this.isLoading=false;return true}catch(t){if(t.message==="404"){this.fetchingError="The Covet.pics gallery embed has not loaded because the embed does not exist. Please verify that the correct Embed ID is being used"}this.isLoading=false;return this.fetchingError}}async findAndLoadSharedItemId(){return new Promise((async t=>{if(this.loader.previewPopupMode){const e=this.items.find((t=>t.source!=="upload_widget"));return t(typeof e!=="undefined"?e.id.toString():"none")}const e=a(this.loader.embedId,this.loader.galleryType);if(e===null)return t("none");const i=this.items.findIndex((t=>t.id===parseInt(e)))!==-1;if(i)return t(e.toString());const s=await this.loader.fetchItems();if(typeof s==="undefined")return t("none");this.items=[...this.items,...s.items];return t(this.findAndLoadSharedItemId())}))}setWidgetWidth(){const t=this.isWidgetWrapExist()?this.el.getBoundingClientRect().width:320;return this.appStore.dispatch(zt(t))}isWidgetWrapExist(){return this.el.parentElement!==undefined&&this.el.parentElement instanceof HTMLElement}get hasEnoughPhotos(){if(this.items.length===0)return false;if(this.minNumberOfPhotos===null)return true;if(this.loader===undefined||this.loader.data===undefined)return false;if(this.loader.data.items!==undefined&&this.loader.data.items.length<this.minNumberOfPhotos&&this.loader.page===1)return false;return true}initFilters(){const t=this.loader.previewSettings["filters"];this.loader.data.filters.list.forEach((t=>this.filters[t]=false));if(this.appState.preview.mode&&typeof t!=="undefined"){t.forEach((t=>this.filters[t]=true))}}loadFont(){if(this.loader.data.settings.font_family){const t=document.createElement("link");t.setAttribute("rel","stylesheet");t.setAttribute("href","https://fonts.googleapis.com/css2?family="+this.loader.data.settings.font_family.split(" ").join("+")+":wght@300;400;600;700&display=swap");document.head.appendChild(t)}this.fontsLoaded=true}setWidgetCSSVariables(){let t={};if(this.loader.data.settings.font_family&&this.loader.data.settings.font_family!==""){t["--covet-internal-font-family"]=`${this.appState.settings.font_family}`}return t}getItemsWithUpload(t){if(!this.loader.data.settings.customer_photo_item_position)return t;const e=this.loader.data.settings.customer_photo_item_position-1;const i={source:"upload_widget",imageUrl:this.appState.settings.customer_widget_cover!==null?this.appState.settings.customer_widget_cover:undefined};t.splice(e,0,i);return t}renderSliderGallery(){return i(s,{style:this.setWidgetCSSVariables(),class:"needsclick"},i("covet-pics-gallery-slider",{items:this.items,"shared-item-id":this.sharedItemId,"slider-style":this.loader.data.settings.slideshow_style,appStore:this.appStore}))}renderGridGallery(){var t,e,o;return i(s,{style:this.setWidgetCSSVariables(),class:"needsclick"},i("covet-pics-gallery-grid",{items:this.items,rating:(t=this.loader.data.reviews)===null||t===void 0?void 0:t.rating,"rating-count":(e=this.loader.data.reviews)===null||e===void 0?void 0:e.rating_count,"product-title":this.loader.data.product_title,breakdown:(o=this.loader.data.reviews)===null||o===void 0?void 0:o.breakdown,"filters-enabled":this.loader.data.filters.enabled,"shared-item-id":this.sharedItemId,filters:this.filters,"show-load-more":this.appState.settings.pagination==="button"&&!this.isLoading&&this.loader.totalPages>this.loader.page&&this.items.length>0,appStore:this.appStore}))}renderHighlighted(){return i(s,{style:this.setWidgetCSSVariables(),class:"highlighted"},i("covet-pics-highlighted",{numberOfPages:this.loader.data.items.length,items:this.loader.data.items,appStore:this.appStore}))}hideElementsIfEmpty(){let t=this.hideElements;if(!t){t=this.loader.data.settings.selector_to_hide}const e=this.loader.data.items;const i=typeof e!=="undefined"&&e.length===0||!this.hasEnoughPhotos;if(i&&t!==""){const e=document.querySelectorAll(t);e.forEach((t=>t.style.display="none"))}}renderUploadStandalone(){return i("covet-pics-upload",{standalone:true,appStore:this.appStore})}renderError(){return i(s,null,i("p",{class:"error-message"},this.fetchingError))}render(){if(!this.isLoading&&this.fetchingError!==null)return this.renderError();if(!this.isLoading&&this.hasEnoughPhotos){const t=this.loader.data.settings.display_type;if(t==="upload-standalone")return this.renderUploadStandalone();if(t==="slider")return this.renderSliderGallery();if(t==="highlight")return this.renderHighlighted();return this.renderGridGallery()}}get el(){return o(this)}};Jt.style=Vt;export{Jt as covet_pics_widget};
//# sourceMappingURL=p-87c20e50.entry.js.map